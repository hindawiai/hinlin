<शैली गुरु>
// SPDX-License-Identअगरier: GPL-2.0
/*
 * Copyright (C) 2019, Intel Corporation
 */
#समावेश <linux/slab.h>
#समावेश <linux/clk-provider.h>
#समावेश <linux/of_device.h>
#समावेश <linux/of_address.h>
#समावेश <linux/platक्रमm_device.h>

#समावेश <dt-bindings/घड़ी/agilex-घड़ी.h>

#समावेश "stratix10-clk.h"

अटल स्थिर काष्ठा clk_parent_data pll_mux[] = अणु
	अणु .fw_name = "osc1",
	  .name = "osc1", पूर्ण,
	अणु .fw_name = "cb-intosc-hs-div2-clk",
	  .name = "cb-intosc-hs-div2-clk", पूर्ण,
	अणु .fw_name = "f2s-free-clk",
	  .name = "f2s-free-clk", पूर्ण,
पूर्ण;

अटल स्थिर काष्ठा clk_parent_data boot_mux[] = अणु
	अणु .fw_name = "osc1",
	  .name = "osc1", पूर्ण,
	अणु .fw_name = "cb-intosc-hs-div2-clk",
	  .name = "cb-intosc-hs-div2-clk", पूर्ण,
पूर्ण;

अटल स्थिर काष्ठा clk_parent_data mpu_मुक्त_mux[] = अणु
	अणु .fw_name = "main_pll_c0",
	  .name = "main_pll_c0", पूर्ण,
	अणु .fw_name = "peri_pll_c0",
	  .name = "peri_pll_c0", पूर्ण,
	अणु .fw_name = "osc1",
	  .name = "osc1", पूर्ण,
	अणु .fw_name = "cb-intosc-hs-div2-clk",
	  .name = "cb-intosc-hs-div2-clk", पूर्ण,
	अणु .fw_name = "f2s-free-clk",
	  .name = "f2s-free-clk", पूर्ण,
पूर्ण;

अटल स्थिर काष्ठा clk_parent_data noc_मुक्त_mux[] = अणु
	अणु .fw_name = "main_pll_c1",
	  .name = "main_pll_c1", पूर्ण,
	अणु .fw_name = "peri_pll_c1",
	  .name = "peri_pll_c1", पूर्ण,
	अणु .fw_name = "osc1",
	  .name = "osc1", पूर्ण,
	अणु .fw_name = "cb-intosc-hs-div2-clk",
	  .name = "cb-intosc-hs-div2-clk", पूर्ण,
	अणु .fw_name = "f2s-free-clk",
	  .name = "f2s-free-clk", पूर्ण,
पूर्ण;

अटल स्थिर काष्ठा clk_parent_data emaca_मुक्त_mux[] = अणु
	अणु .fw_name = "main_pll_c2",
	  .name = "main_pll_c2", पूर्ण,
	अणु .fw_name = "peri_pll_c2",
	  .name = "peri_pll_c2", पूर्ण,
	अणु .fw_name = "osc1",
	  .name = "osc1", पूर्ण,
	अणु .fw_name = "cb-intosc-hs-div2-clk",
	  .name = "cb-intosc-hs-div2-clk", पूर्ण,
	अणु .fw_name = "f2s-free-clk",
	  .name = "f2s-free-clk", पूर्ण,
पूर्ण;

अटल स्थिर काष्ठा clk_parent_data emacb_मुक्त_mux[] = अणु
	अणु .fw_name = "main_pll_c3",
	  .name = "main_pll_c3", पूर्ण,
	अणु .fw_name = "peri_pll_c3",
	  .name = "peri_pll_c3", पूर्ण,
	अणु .fw_name = "osc1",
	  .name = "osc1", पूर्ण,
	अणु .fw_name = "cb-intosc-hs-div2-clk",
	  .name = "cb-intosc-hs-div2-clk", पूर्ण,
	अणु .fw_name = "f2s-free-clk",
	  .name = "f2s-free-clk", पूर्ण,
पूर्ण;

अटल स्थिर काष्ठा clk_parent_data emac_ptp_मुक्त_mux[] = अणु
	अणु .fw_name = "main_pll_c3",
	  .name = "main_pll_c3", पूर्ण,
	अणु .fw_name = "peri_pll_c3",
	  .name = "peri_pll_c3", पूर्ण,
	अणु .fw_name = "osc1",
	  .name = "osc1", पूर्ण,
	अणु .fw_name = "cb-intosc-hs-div2-clk",
	  .name = "cb-intosc-hs-div2-clk", पूर्ण,
	अणु .fw_name = "f2s-free-clk",
	  .name = "f2s-free-clk", पूर्ण,
पूर्ण;

अटल स्थिर काष्ठा clk_parent_data gpio_db_मुक्त_mux[] = अणु
	अणु .fw_name = "main_pll_c3",
	  .name = "main_pll_c3", पूर्ण,
	अणु .fw_name = "peri_pll_c3",
	  .name = "peri_pll_c3", पूर्ण,
	अणु .fw_name = "osc1",
	  .name = "osc1", पूर्ण,
	अणु .fw_name = "cb-intosc-hs-div2-clk",
	  .name = "cb-intosc-hs-div2-clk", पूर्ण,
	अणु .fw_name = "f2s-free-clk",
	  .name = "f2s-free-clk", पूर्ण,
पूर्ण;

अटल स्थिर काष्ठा clk_parent_data psi_ref_मुक्त_mux[] = अणु
	अणु .fw_name = "main_pll_c3",
	  .name = "main_pll_c3", पूर्ण,
	अणु .fw_name = "peri_pll_c3",
	  .name = "peri_pll_c3", पूर्ण,
	अणु .fw_name = "osc1",
	  .name = "osc1", पूर्ण,
	अणु .fw_name = "cb-intosc-hs-div2-clk",
	  .name = "cb-intosc-hs-div2-clk", पूर्ण,
	अणु .fw_name = "f2s-free-clk",
	  .name = "f2s-free-clk", पूर्ण,
पूर्ण;

अटल स्थिर काष्ठा clk_parent_data sdmmc_मुक्त_mux[] = अणु
	अणु .fw_name = "main_pll_c3",
	  .name = "main_pll_c3", पूर्ण,
	अणु .fw_name = "peri_pll_c3",
	  .name = "peri_pll_c3", पूर्ण,
	अणु .fw_name = "osc1",
	  .name = "osc1", पूर्ण,
	अणु .fw_name = "cb-intosc-hs-div2-clk",
	  .name = "cb-intosc-hs-div2-clk", पूर्ण,
	अणु .fw_name = "f2s-free-clk",
	  .name = "f2s-free-clk", पूर्ण,
पूर्ण;

अटल स्थिर काष्ठा clk_parent_data s2f_usr0_मुक्त_mux[] = अणु
	अणु .fw_name = "main_pll_c2",
	  .name = "main_pll_c2", पूर्ण,
	अणु .fw_name = "peri_pll_c2",
	  .name = "peri_pll_c2", पूर्ण,
	अणु .fw_name = "osc1",
	  .name = "osc1", पूर्ण,
	अणु .fw_name = "cb-intosc-hs-div2-clk",
	  .name = "cb-intosc-hs-div2-clk", पूर्ण,
	अणु .fw_name = "f2s-free-clk",
	  .name = "f2s-free-clk", पूर्ण,
पूर्ण;

अटल स्थिर काष्ठा clk_parent_data s2f_usr1_मुक्त_mux[] = अणु
	अणु .fw_name = "main_pll_c2",
	  .name = "main_pll_c2", पूर्ण,
	अणु .fw_name = "peri_pll_c2",
	  .name = "peri_pll_c2", पूर्ण,
	अणु .fw_name = "osc1",
	  .name = "osc1", पूर्ण,
	अणु .fw_name = "cb-intosc-hs-div2-clk",
	  .name = "cb-intosc-hs-div2-clk", पूर्ण,
	अणु .fw_name = "f2s-free-clk",
	  .name = "f2s-free-clk", पूर्ण,
पूर्ण;

अटल स्थिर काष्ठा clk_parent_data mpu_mux[] = अणु
	अणु .fw_name = "mpu_free_clk",
	  .name = "mpu_free_clk", पूर्ण,
	अणु .fw_name = "boot_clk",
	  .name = "boot_clk", पूर्ण,
पूर्ण;

अटल स्थिर काष्ठा clk_parent_data s2f_usr0_mux[] = अणु
	अणु .fw_name = "f2s-free-clk",
	  .name = "f2s-free-clk", पूर्ण,
	अणु .fw_name = "boot_clk",
	  .name = "boot_clk", पूर्ण,
पूर्ण;

अटल स्थिर काष्ठा clk_parent_data emac_mux[] = अणु
	अणु .fw_name = "emaca_free_clk",
	  .name = "emaca_free_clk", पूर्ण,
	अणु .fw_name = "emacb_free_clk",
	  .name = "emacb_free_clk", पूर्ण,
पूर्ण;

अटल स्थिर काष्ठा clk_parent_data noc_mux[] = अणु
	अणु .fw_name = "noc_free_clk",
	  .name = "noc_free_clk", पूर्ण,
	अणु .fw_name = "boot_clk",
	  .name = "boot_clk", पूर्ण,
पूर्ण;

/* घड़ीs in AO (always on) controller */
अटल स्थिर काष्ठा stratix10_pll_घड़ी agilex_pll_clks[] = अणु
	अणु AGILEX_BOOT_CLK, "boot_clk", boot_mux, ARRAY_SIZE(boot_mux), 0,
	  0x0पूर्ण,
	अणु AGILEX_MAIN_PLL_CLK, "main_pll", pll_mux, ARRAY_SIZE(pll_mux),
	  0, 0x48पूर्ण,
	अणु AGILEX_PERIPH_PLL_CLK, "periph_pll", pll_mux, ARRAY_SIZE(pll_mux),
	  0, 0x9cपूर्ण,
पूर्ण;

अटल स्थिर काष्ठा n5x_perip_c_घड़ी n5x_मुख्य_perip_c_clks[] = अणु
	अणु AGILEX_MAIN_PLL_C0_CLK, "main_pll_c0", "main_pll", शून्य, 1, 0, 0x54, 0पूर्ण,
	अणु AGILEX_MAIN_PLL_C1_CLK, "main_pll_c1", "main_pll", शून्य, 1, 0, 0x54, 8पूर्ण,
	अणु AGILEX_MAIN_PLL_C2_CLK, "main_pll_c2", "main_pll", शून्य, 1, 0, 0x54, 16पूर्ण,
	अणु AGILEX_MAIN_PLL_C3_CLK, "main_pll_c3", "main_pll", शून्य, 1, 0, 0x54, 24पूर्ण,
	अणु AGILEX_PERIPH_PLL_C0_CLK, "peri_pll_c0", "periph_pll", शून्य, 1, 0, 0xA8, 0पूर्ण,
	अणु AGILEX_PERIPH_PLL_C1_CLK, "peri_pll_c1", "periph_pll", शून्य, 1, 0, 0xA8, 8पूर्ण,
	अणु AGILEX_PERIPH_PLL_C2_CLK, "peri_pll_c2", "periph_pll", शून्य, 1, 0, 0xA8, 16पूर्ण,
	अणु AGILEX_PERIPH_PLL_C3_CLK, "peri_pll_c3", "periph_pll", शून्य, 1, 0, 0xA8, 24पूर्ण,
पूर्ण;

अटल स्थिर काष्ठा stratix10_perip_c_घड़ी agilex_मुख्य_perip_c_clks[] = अणु
	अणु AGILEX_MAIN_PLL_C0_CLK, "main_pll_c0", "main_pll", शून्य, 1, 0, 0x58पूर्ण,
	अणु AGILEX_MAIN_PLL_C1_CLK, "main_pll_c1", "main_pll", शून्य, 1, 0, 0x5Cपूर्ण,
	अणु AGILEX_MAIN_PLL_C2_CLK, "main_pll_c2", "main_pll", शून्य, 1, 0, 0x64पूर्ण,
	अणु AGILEX_MAIN_PLL_C3_CLK, "main_pll_c3", "main_pll", शून्य, 1, 0, 0x68पूर्ण,
	अणु AGILEX_PERIPH_PLL_C0_CLK, "peri_pll_c0", "periph_pll", शून्य, 1, 0, 0xACपूर्ण,
	अणु AGILEX_PERIPH_PLL_C1_CLK, "peri_pll_c1", "periph_pll", शून्य, 1, 0, 0xB0पूर्ण,
	अणु AGILEX_PERIPH_PLL_C2_CLK, "peri_pll_c2", "periph_pll", शून्य, 1, 0, 0xB8पूर्ण,
	अणु AGILEX_PERIPH_PLL_C3_CLK, "peri_pll_c3", "periph_pll", शून्य, 1, 0, 0xBCपूर्ण,
पूर्ण;

अटल स्थिर काष्ठा stratix10_perip_cnt_घड़ी agilex_मुख्य_perip_cnt_clks[] = अणु
	अणु AGILEX_MPU_FREE_CLK, "mpu_free_clk", शून्य, mpu_मुक्त_mux, ARRAY_SIZE(mpu_मुक्त_mux),
	   0, 0x3C, 0, 0, 0पूर्ण,
	अणु AGILEX_NOC_FREE_CLK, "noc_free_clk", शून्य, noc_मुक्त_mux, ARRAY_SIZE(noc_मुक्त_mux),
	  0, 0x40, 0, 0, 1पूर्ण,
	अणु AGILEX_L4_SYS_FREE_CLK, "l4_sys_free_clk", "noc_free_clk", शून्य, 1, 0,
	  0, 4, 0, 0पूर्ण,
	अणु AGILEX_NOC_CLK, "noc_clk", शून्य, noc_mux, ARRAY_SIZE(noc_mux),
	  0, 0, 0, 0x30, 1पूर्ण,
	अणु AGILEX_EMAC_A_FREE_CLK, "emaca_free_clk", शून्य, emaca_मुक्त_mux, ARRAY_SIZE(emaca_मुक्त_mux),
	  0, 0xD4, 0, 0x88, 0पूर्ण,
	अणु AGILEX_EMAC_B_FREE_CLK, "emacb_free_clk", शून्य, emacb_मुक्त_mux, ARRAY_SIZE(emacb_मुक्त_mux),
	  0, 0xD8, 0, 0x88, 1पूर्ण,
	अणु AGILEX_EMAC_PTP_FREE_CLK, "emac_ptp_free_clk", शून्य, emac_ptp_मुक्त_mux,
	  ARRAY_SIZE(emac_ptp_मुक्त_mux), 0, 0xDC, 0, 0x88, 2पूर्ण,
	अणु AGILEX_GPIO_DB_FREE_CLK, "gpio_db_free_clk", शून्य, gpio_db_मुक्त_mux,
	  ARRAY_SIZE(gpio_db_मुक्त_mux), 0, 0xE0, 0, 0x88, 3पूर्ण,
	अणु AGILEX_SDMMC_FREE_CLK, "sdmmc_free_clk", शून्य, sdmmc_मुक्त_mux,
	  ARRAY_SIZE(sdmmc_मुक्त_mux), 0, 0xE4, 0, 0x88, 4पूर्ण,
	अणु AGILEX_S2F_USER0_FREE_CLK, "s2f_user0_free_clk", शून्य, s2f_usr0_मुक्त_mux,
	  ARRAY_SIZE(s2f_usr0_मुक्त_mux), 0, 0xE8, 0, 0, 0पूर्ण,
	अणु AGILEX_S2F_USER1_FREE_CLK, "s2f_user1_free_clk", शून्य, s2f_usr1_मुक्त_mux,
	  ARRAY_SIZE(s2f_usr1_मुक्त_mux), 0, 0xEC, 0, 0x88, 5पूर्ण,
	अणु AGILEX_PSI_REF_FREE_CLK, "psi_ref_free_clk", शून्य, psi_ref_मुक्त_mux,
	  ARRAY_SIZE(psi_ref_मुक्त_mux), 0, 0xF0, 0, 0x88, 6पूर्ण,
पूर्ण;

अटल स्थिर काष्ठा stratix10_gate_घड़ी agilex_gate_clks[] = अणु
	अणु AGILEX_MPU_CLK, "mpu_clk", शून्य, mpu_mux, ARRAY_SIZE(mpu_mux), 0, 0x24,
	  0, 0, 0, 0, 0x30, 0, 0पूर्ण,
	अणु AGILEX_MPU_PERIPH_CLK, "mpu_periph_clk", "mpu_clk", शून्य, 1, 0, 0x24,
	  0, 0, 0, 0, 0, 0, 4पूर्ण,
	अणु AGILEX_MPU_CCU_CLK, "mpu_ccu_clk", "mpu_clk", शून्य, 1, 0, 0x24,
	  0, 0, 0, 0, 0, 0, 2पूर्ण,
	अणु AGILEX_L4_MAIN_CLK, "l4_main_clk", "noc_clk", शून्य, 1, 0, 0x24,
	  1, 0x44, 0, 2, 0, 0, 0पूर्ण,
	अणु AGILEX_L4_MP_CLK, "l4_mp_clk", "noc_clk", शून्य, 1, 0, 0x24,
	  2, 0x44, 8, 2, 0, 0, 0पूर्ण,
	/*
	 * The l4_sp_clk feeds a 100 MHz घड़ी to various peripherals, one of them
	 * being the SP समयrs, thus cannot get gated.
	 */
	अणु AGILEX_L4_SP_CLK, "l4_sp_clk", "noc_clk", शून्य, 1, CLK_IS_CRITICAL, 0x24,
	  3, 0x44, 16, 2, 0, 0, 0पूर्ण,
	अणु AGILEX_CS_AT_CLK, "cs_at_clk", "noc_clk", शून्य, 1, 0, 0x24,
	  4, 0x44, 24, 2, 0, 0, 0पूर्ण,
	अणु AGILEX_CS_TRACE_CLK, "cs_trace_clk", "noc_clk", शून्य, 1, 0, 0x24,
	  4, 0x44, 26, 2, 0, 0, 0पूर्ण,
	अणु AGILEX_CS_PDBG_CLK, "cs_pdbg_clk", "cs_at_clk", शून्य, 1, 0, 0x24,
	  4, 0x44, 28, 1, 0, 0, 0पूर्ण,
	अणु AGILEX_CS_TIMER_CLK, "cs_timer_clk", "noc_clk", शून्य, 1, 0, 0x24,
	  5, 0, 0, 0, 0, 0, 0पूर्ण,
	अणु AGILEX_S2F_USER0_CLK, "s2f_user0_clk", शून्य, s2f_usr0_mux, ARRAY_SIZE(s2f_usr0_mux), 0, 0x24,
	  6, 0, 0, 0, 0, 0, 0पूर्ण,
	अणु AGILEX_EMAC0_CLK, "emac0_clk", शून्य, emac_mux, ARRAY_SIZE(emac_mux), 0, 0x7C,
	  0, 0, 0, 0, 0x94, 26, 0पूर्ण,
	अणु AGILEX_EMAC1_CLK, "emac1_clk", शून्य, emac_mux, ARRAY_SIZE(emac_mux), 0, 0x7C,
	  1, 0, 0, 0, 0x94, 27, 0पूर्ण,
	अणु AGILEX_EMAC2_CLK, "emac2_clk", शून्य, emac_mux, ARRAY_SIZE(emac_mux), 0, 0x7C,
	  2, 0, 0, 0, 0x94, 28, 0पूर्ण,
	अणु AGILEX_EMAC_PTP_CLK, "emac_ptp_clk", "emac_ptp_free_clk", शून्य, 1, 0, 0x7C,
	  3, 0, 0, 0, 0, 0, 0पूर्ण,
	अणु AGILEX_GPIO_DB_CLK, "gpio_db_clk", "gpio_db_free_clk", शून्य, 1, 0, 0x7C,
	  4, 0x98, 0, 16, 0, 0, 0पूर्ण,
	अणु AGILEX_SDMMC_CLK, "sdmmc_clk", "sdmmc_free_clk", शून्य, 1, 0, 0x7C,
	  5, 0, 0, 0, 0, 0, 4पूर्ण,
	अणु AGILEX_S2F_USER1_CLK, "s2f_user1_clk", "s2f_user1_free_clk", शून्य, 1, 0, 0x7C,
	  6, 0, 0, 0, 0, 0, 0पूर्ण,
	अणु AGILEX_PSI_REF_CLK, "psi_ref_clk", "psi_ref_free_clk", शून्य, 1, 0, 0x7C,
	  7, 0, 0, 0, 0, 0, 0पूर्ण,
	अणु AGILEX_USB_CLK, "usb_clk", "l4_mp_clk", शून्य, 1, 0, 0x7C,
	  8, 0, 0, 0, 0, 0, 0पूर्ण,
	अणु AGILEX_SPI_M_CLK, "spi_m_clk", "l4_mp_clk", शून्य, 1, 0, 0x7C,
	  9, 0, 0, 0, 0, 0, 0पूर्ण,
	अणु AGILEX_न_अंकD_X_CLK, "nand_x_clk", "l4_mp_clk", शून्य, 1, 0, 0x7C,
	  10, 0, 0, 0, 0, 0, 0पूर्ण,
	अणु AGILEX_न_अंकD_CLK, "nand_clk", "nand_x_clk", शून्य, 1, 0, 0x7C,
	  10, 0, 0, 0, 0, 0, 4पूर्ण,
	अणु AGILEX_न_अंकD_ECC_CLK, "nand_ecc_clk", "nand_x_clk", शून्य, 1, 0, 0x7C,
	  10, 0, 0, 0, 0, 0, 4पूर्ण,
पूर्ण;

अटल पूर्णांक n5x_clk_रेजिस्टर_c_perip(स्थिर काष्ठा n5x_perip_c_घड़ी *clks,
				       पूर्णांक nums, काष्ठा stratix10_घड़ी_data *data)
अणु
	काष्ठा clk_hw *hw_clk;
	व्योम __iomem *base = data->base;
	पूर्णांक i;

	क्रम (i = 0; i < nums; i++) अणु
		hw_clk = n5x_रेजिस्टर_periph(&clks[i], base);
		अगर (IS_ERR(hw_clk)) अणु
			pr_err("%s: failed to register clock %s\n",
			       __func__, clks[i].name);
			जारी;
		पूर्ण
		data->clk_data.hws[clks[i].id] = hw_clk;
	पूर्ण
	वापस 0;
पूर्ण

अटल पूर्णांक agilex_clk_रेजिस्टर_c_perip(स्थिर काष्ठा stratix10_perip_c_घड़ी *clks,
				       पूर्णांक nums, काष्ठा stratix10_घड़ी_data *data)
अणु
	काष्ठा clk_hw *hw_clk;
	व्योम __iomem *base = data->base;
	पूर्णांक i;

	क्रम (i = 0; i < nums; i++) अणु
		hw_clk = s10_रेजिस्टर_periph(&clks[i], base);
		अगर (IS_ERR(hw_clk)) अणु
			pr_err("%s: failed to register clock %s\n",
			       __func__, clks[i].name);
			जारी;
		पूर्ण
		data->clk_data.hws[clks[i].id] = hw_clk;
	पूर्ण
	वापस 0;
पूर्ण

अटल पूर्णांक agilex_clk_रेजिस्टर_cnt_perip(स्थिर काष्ठा stratix10_perip_cnt_घड़ी *clks,
					 पूर्णांक nums, काष्ठा stratix10_घड़ी_data *data)
अणु
	काष्ठा clk_hw *hw_clk;
	व्योम __iomem *base = data->base;
	पूर्णांक i;

	क्रम (i = 0; i < nums; i++) अणु
		hw_clk = s10_रेजिस्टर_cnt_periph(&clks[i], base);
		अगर (IS_ERR(hw_clk)) अणु
			pr_err("%s: failed to register clock %s\n",
			       __func__, clks[i].name);
			जारी;
		पूर्ण
		data->clk_data.hws[clks[i].id] = hw_clk;
	पूर्ण

	वापस 0;
पूर्ण

अटल पूर्णांक agilex_clk_रेजिस्टर_gate(स्थिर काष्ठा stratix10_gate_घड़ी *clks,
				    पूर्णांक nums, काष्ठा stratix10_घड़ी_data *data)
अणु
	काष्ठा clk_hw *hw_clk;
	व्योम __iomem *base = data->base;
	पूर्णांक i;

	क्रम (i = 0; i < nums; i++) अणु
		hw_clk = s10_रेजिस्टर_gate(&clks[i], base);
		अगर (IS_ERR(hw_clk)) अणु
			pr_err("%s: failed to register clock %s\n",
			       __func__, clks[i].name);
			जारी;
		पूर्ण
		data->clk_data.hws[clks[i].id] = hw_clk;
	पूर्ण

	वापस 0;
पूर्ण

अटल पूर्णांक agilex_clk_रेजिस्टर_pll(स्थिर काष्ठा stratix10_pll_घड़ी *clks,
				 पूर्णांक nums, काष्ठा stratix10_घड़ी_data *data)
अणु
	काष्ठा clk_hw *hw_clk;
	व्योम __iomem *base = data->base;
	पूर्णांक i;

	क्रम (i = 0; i < nums; i++) अणु
		hw_clk = agilex_रेजिस्टर_pll(&clks[i], base);
		अगर (IS_ERR(hw_clk)) अणु
			pr_err("%s: failed to register clock %s\n",
			       __func__, clks[i].name);
			जारी;
		पूर्ण
		data->clk_data.hws[clks[i].id] = hw_clk;
	पूर्ण

	वापस 0;
पूर्ण

अटल पूर्णांक n5x_clk_रेजिस्टर_pll(स्थिर काष्ठा stratix10_pll_घड़ी *clks,
				 पूर्णांक nums, काष्ठा stratix10_घड़ी_data *data)
अणु
	काष्ठा clk_hw *hw_clk;
	व्योम __iomem *base = data->base;
	पूर्णांक i;

	क्रम (i = 0; i < nums; i++) अणु
		hw_clk = n5x_रेजिस्टर_pll(&clks[i], base);
		अगर (IS_ERR(hw_clk)) अणु
			pr_err("%s: failed to register clock %s\n",
			       __func__, clks[i].name);
			जारी;
		पूर्ण
		data->clk_data.hws[clks[i].id] = hw_clk;
	पूर्ण

	वापस 0;
पूर्ण

अटल पूर्णांक agilex_clkmgr_init(काष्ठा platक्रमm_device *pdev)
अणु
	काष्ठा device_node *np = pdev->dev.of_node;
	काष्ठा device *dev = &pdev->dev;
	काष्ठा stratix10_घड़ी_data *clk_data;
	काष्ठा resource *res;
	व्योम __iomem *base;
	पूर्णांक i, num_clks;

	res = platक्रमm_get_resource(pdev, IORESOURCE_MEM, 0);
	base = devm_ioremap_resource(dev, res);
	अगर (IS_ERR(base))
		वापस PTR_ERR(base);

	num_clks = AGILEX_NUM_CLKS;

	clk_data = devm_kzalloc(dev, काष्ठा_size(clk_data, clk_data.hws,
				num_clks), GFP_KERNEL);
	अगर (!clk_data)
		वापस -ENOMEM;

	क्रम (i = 0; i < num_clks; i++)
		clk_data->clk_data.hws[i] = ERR_PTR(-ENOENT);

	clk_data->base = base;
	clk_data->clk_data.num = num_clks;

	agilex_clk_रेजिस्टर_pll(agilex_pll_clks, ARRAY_SIZE(agilex_pll_clks), clk_data);

	agilex_clk_रेजिस्टर_c_perip(agilex_मुख्य_perip_c_clks,
				 ARRAY_SIZE(agilex_मुख्य_perip_c_clks), clk_data);

	agilex_clk_रेजिस्टर_cnt_perip(agilex_मुख्य_perip_cnt_clks,
				   ARRAY_SIZE(agilex_मुख्य_perip_cnt_clks),
				   clk_data);

	agilex_clk_रेजिस्टर_gate(agilex_gate_clks, ARRAY_SIZE(agilex_gate_clks),
			      clk_data);
	of_clk_add_hw_provider(np, of_clk_hw_onecell_get, &clk_data->clk_data);
	वापस 0;
पूर्ण

अटल पूर्णांक n5x_clkmgr_init(काष्ठा platक्रमm_device *pdev)
अणु
	काष्ठा device_node *np = pdev->dev.of_node;
	काष्ठा device *dev = &pdev->dev;
	काष्ठा stratix10_घड़ी_data *clk_data;
	काष्ठा resource *res;
	व्योम __iomem *base;
	पूर्णांक i, num_clks;

	res = platक्रमm_get_resource(pdev, IORESOURCE_MEM, 0);
	base = devm_ioremap_resource(dev, res);
	अगर (IS_ERR(base))
		वापस PTR_ERR(base);

	num_clks = AGILEX_NUM_CLKS;

	clk_data = devm_kzalloc(dev, काष्ठा_size(clk_data, clk_data.hws,
				num_clks), GFP_KERNEL);
	अगर (!clk_data)
		वापस -ENOMEM;

	क्रम (i = 0; i < num_clks; i++)
		clk_data->clk_data.hws[i] = ERR_PTR(-ENOENT);

	clk_data->base = base;
	clk_data->clk_data.num = num_clks;

	n5x_clk_रेजिस्टर_pll(agilex_pll_clks, ARRAY_SIZE(agilex_pll_clks), clk_data);

	n5x_clk_रेजिस्टर_c_perip(n5x_मुख्य_perip_c_clks,
				 ARRAY_SIZE(n5x_मुख्य_perip_c_clks), clk_data);

	agilex_clk_रेजिस्टर_cnt_perip(agilex_मुख्य_perip_cnt_clks,
				   ARRAY_SIZE(agilex_मुख्य_perip_cnt_clks),
				   clk_data);

	agilex_clk_रेजिस्टर_gate(agilex_gate_clks, ARRAY_SIZE(agilex_gate_clks),
			      clk_data);
	of_clk_add_hw_provider(np, of_clk_hw_onecell_get, &clk_data->clk_data);
	वापस 0;
पूर्ण

अटल पूर्णांक agilex_clkmgr_probe(काष्ठा platक्रमm_device *pdev)
अणु
	पूर्णांक (*probe_func)(काष्ठा platक्रमm_device *init_func);

	probe_func = of_device_get_match_data(&pdev->dev);
	अगर (!probe_func)
		वापस -ENODEV;
	वापस	probe_func(pdev);
पूर्ण

अटल स्थिर काष्ठा of_device_id agilex_clkmgr_match_table[] = अणु
	अणु .compatible = "intel,agilex-clkmgr",
	  .data = agilex_clkmgr_init पूर्ण,
	अणु .compatible = "intel,easic-n5x-clkmgr",
	  .data = n5x_clkmgr_init पूर्ण,
	अणु पूर्ण
पूर्ण;

अटल काष्ठा platक्रमm_driver agilex_clkmgr_driver = अणु
	.probe		= agilex_clkmgr_probe,
	.driver		= अणु
		.name	= "agilex-clkmgr",
		.suppress_bind_attrs = true,
		.of_match_table = agilex_clkmgr_match_table,
	पूर्ण,
पूर्ण;

अटल पूर्णांक __init agilex_clk_init(व्योम)
अणु
	वापस platक्रमm_driver_रेजिस्टर(&agilex_clkmgr_driver);
पूर्ण
core_initcall(agilex_clk_init);
