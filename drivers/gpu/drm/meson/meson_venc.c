<शैली गुरु>
// SPDX-License-Identअगरier: GPL-2.0-or-later
/*
 * Copyright (C) 2016 BayLibre, SAS
 * Author: Neil Armstrong <narmstrong@baylibre.com>
 * Copyright (C) 2015 Amlogic, Inc. All rights reserved.
 */

#समावेश <linux/export.h>

#समावेश <drm/drm_modes.h>

#समावेश "meson_drv.h"
#समावेश "meson_registers.h"
#समावेश "meson_venc.h"
#समावेश "meson_vpp.h"

/**
 * DOC: Video Encoder
 *
 * VENC Handle the pixels encoding to the output क्रमmats.
 * We handle the following encodings :
 *
 * - CVBS Encoding via the ENCI encoder and VDAC digital to analog converter
 * - TMDS/HDMI Encoding via ENCI_DIV and ENCP
 * - Setup of more घड़ी rates क्रम HDMI modes
 *
 * What is missing :
 *
 * - LCD Panel encoding via ENCL
 * - TV Panel encoding via ENCT
 *
 * VENC paths :
 *
 * .. code::
 *
 *          _____   _____   ____________________
 *   vd1---|     |-|     | | VENC     /---------|----VDAC
 *   vd2---| VIU |-| VPP |-|-----ENCI/-ENCI_DVI-|-|
 *   osd1--|     |-|     | | \                  | X--HDMI-TX
 *   osd2--|_____|-|_____| |  |\-ENCP--ENCP_DVI-|-|
 *                         |  |                 |
 *                         |  \--ENCL-----------|----LVDS
 *                         |____________________|
 *
 * The ENCI is deचिन्हित क्रम PAl or NTSC encoding and can go through the VDAC
 * directly क्रम CVBS encoding or through the ENCI_DVI encoder क्रम HDMI.
 * The ENCP is deचिन्हित क्रम Progressive encoding but can also generate
 * 1080i पूर्णांकerlaced pixels, and was initially deचिन्हित to encode pixels क्रम
 * VDAC to output RGB ou YUV analog outमाला_दो.
 * It's output is only used through the ENCP_DVI encoder क्रम HDMI.
 * The ENCL LVDS encoder is not implemented.
 *
 * The ENCI and ENCP encoders needs specially defined parameters क्रम each
 * supported mode and thus cannot be determined from standard video timings.
 *
 * The ENCI end ENCP DVI encoders are more generic and can generate any timings
 * from the pixel data generated by ENCI or ENCP, so can use the standard video
 * timings are source क्रम HW parameters.
 */

/* HHI Registers */
#घोषणा HHI_GCLK_MPEG2		0x148 /* 0x52 offset in data sheet */
#घोषणा HHI_VDAC_CNTL0		0x2F4 /* 0xbd offset in data sheet */
#घोषणा HHI_VDAC_CNTL0_G12A	0x2EC /* 0xbb offset in data sheet */
#घोषणा HHI_VDAC_CNTL1		0x2F8 /* 0xbe offset in data sheet */
#घोषणा HHI_VDAC_CNTL1_G12A	0x2F0 /* 0xbc offset in data sheet */
#घोषणा HHI_HDMI_PHY_CNTL0	0x3a0 /* 0xe8 offset in data sheet */

काष्ठा meson_cvbs_enci_mode meson_cvbs_enci_pal = अणु
	.mode_tag = MESON_VENC_MODE_CVBS_PAL,
	.hso_begin = 3,
	.hso_end = 129,
	.vso_even = 3,
	.vso_odd = 260,
	.macv_max_amp = 7,
	.video_prog_mode = 0xff,
	.video_mode = 0x13,
	.sch_adjust = 0x28,
	.yc_delay = 0x343,
	.pixel_start = 251,
	.pixel_end = 1691,
	.top_field_line_start = 22,
	.top_field_line_end = 310,
	.bottom_field_line_start = 23,
	.bottom_field_line_end = 311,
	.video_saturation = 9,
	.video_contrast = 0,
	.video_brightness = 0,
	.video_hue = 0,
	.analog_sync_adj = 0x8080,
पूर्ण;

काष्ठा meson_cvbs_enci_mode meson_cvbs_enci_ntsc = अणु
	.mode_tag = MESON_VENC_MODE_CVBS_NTSC,
	.hso_begin = 5,
	.hso_end = 129,
	.vso_even = 3,
	.vso_odd = 260,
	.macv_max_amp = 0xb,
	.video_prog_mode = 0xf0,
	.video_mode = 0x8,
	.sch_adjust = 0x20,
	.yc_delay = 0x333,
	.pixel_start = 227,
	.pixel_end = 1667,
	.top_field_line_start = 18,
	.top_field_line_end = 258,
	.bottom_field_line_start = 19,
	.bottom_field_line_end = 259,
	.video_saturation = 18,
	.video_contrast = 3,
	.video_brightness = 0,
	.video_hue = 0,
	.analog_sync_adj = 0x9c00,
पूर्ण;

जोड़ meson_hdmi_venc_mode अणु
	काष्ठा अणु
		अचिन्हित पूर्णांक mode_tag;
		अचिन्हित पूर्णांक hso_begin;
		अचिन्हित पूर्णांक hso_end;
		अचिन्हित पूर्णांक vso_even;
		अचिन्हित पूर्णांक vso_odd;
		अचिन्हित पूर्णांक macv_max_amp;
		अचिन्हित पूर्णांक video_prog_mode;
		अचिन्हित पूर्णांक video_mode;
		अचिन्हित पूर्णांक sch_adjust;
		अचिन्हित पूर्णांक yc_delay;
		अचिन्हित पूर्णांक pixel_start;
		अचिन्हित पूर्णांक pixel_end;
		अचिन्हित पूर्णांक top_field_line_start;
		अचिन्हित पूर्णांक top_field_line_end;
		अचिन्हित पूर्णांक bottom_field_line_start;
		अचिन्हित पूर्णांक bottom_field_line_end;
	पूर्ण enci;
	काष्ठा अणु
		अचिन्हित पूर्णांक dvi_settings;
		अचिन्हित पूर्णांक video_mode;
		अचिन्हित पूर्णांक video_mode_adv;
		अचिन्हित पूर्णांक video_prog_mode;
		bool video_prog_mode_present;
		अचिन्हित पूर्णांक video_sync_mode;
		bool video_sync_mode_present;
		अचिन्हित पूर्णांक video_yc_dly;
		bool video_yc_dly_present;
		अचिन्हित पूर्णांक video_rgb_ctrl;
		bool video_rgb_ctrl_present;
		अचिन्हित पूर्णांक video_filt_ctrl;
		bool video_filt_ctrl_present;
		अचिन्हित पूर्णांक video_ofld_voav_ofst;
		bool video_ofld_voav_ofst_present;
		अचिन्हित पूर्णांक yfp1_hसमय;
		अचिन्हित पूर्णांक yfp2_hसमय;
		अचिन्हित पूर्णांक max_pxcnt;
		अचिन्हित पूर्णांक hspuls_begin;
		अचिन्हित पूर्णांक hspuls_end;
		अचिन्हित पूर्णांक hspuls_चयन;
		अचिन्हित पूर्णांक vspuls_begin;
		अचिन्हित पूर्णांक vspuls_end;
		अचिन्हित पूर्णांक vspuls_bline;
		अचिन्हित पूर्णांक vspuls_eline;
		अचिन्हित पूर्णांक eqpuls_begin;
		bool eqpuls_begin_present;
		अचिन्हित पूर्णांक eqpuls_end;
		bool eqpuls_end_present;
		अचिन्हित पूर्णांक eqpuls_bline;
		bool eqpuls_bline_present;
		अचिन्हित पूर्णांक eqpuls_eline;
		bool eqpuls_eline_present;
		अचिन्हित पूर्णांक havon_begin;
		अचिन्हित पूर्णांक havon_end;
		अचिन्हित पूर्णांक vavon_bline;
		अचिन्हित पूर्णांक vavon_eline;
		अचिन्हित पूर्णांक hso_begin;
		अचिन्हित पूर्णांक hso_end;
		अचिन्हित पूर्णांक vso_begin;
		अचिन्हित पूर्णांक vso_end;
		अचिन्हित पूर्णांक vso_bline;
		अचिन्हित पूर्णांक vso_eline;
		bool vso_eline_present;
		अचिन्हित पूर्णांक sy_val;
		bool sy_val_present;
		अचिन्हित पूर्णांक sy2_val;
		bool sy2_val_present;
		अचिन्हित पूर्णांक max_lncnt;
	पूर्ण encp;
पूर्ण;

जोड़ meson_hdmi_venc_mode meson_hdmi_enci_mode_480i = अणु
	.enci = अणु
		.hso_begin = 5,
		.hso_end = 129,
		.vso_even = 3,
		.vso_odd = 260,
		.macv_max_amp = 0xb,
		.video_prog_mode = 0xf0,
		.video_mode = 0x8,
		.sch_adjust = 0x20,
		.yc_delay = 0,
		.pixel_start = 227,
		.pixel_end = 1667,
		.top_field_line_start = 18,
		.top_field_line_end = 258,
		.bottom_field_line_start = 19,
		.bottom_field_line_end = 259,
	पूर्ण,
पूर्ण;

जोड़ meson_hdmi_venc_mode meson_hdmi_enci_mode_576i = अणु
	.enci = अणु
		.hso_begin = 3,
		.hso_end = 129,
		.vso_even = 3,
		.vso_odd = 260,
		.macv_max_amp = 0x7,
		.video_prog_mode = 0xff,
		.video_mode = 0x13,
		.sch_adjust = 0x28,
		.yc_delay = 0x333,
		.pixel_start = 251,
		.pixel_end = 1691,
		.top_field_line_start = 22,
		.top_field_line_end = 310,
		.bottom_field_line_start = 23,
		.bottom_field_line_end = 311,
	पूर्ण,
पूर्ण;

जोड़ meson_hdmi_venc_mode meson_hdmi_encp_mode_480p = अणु
	.encp = अणु
		.dvi_settings = 0x21,
		.video_mode = 0x4000,
		.video_mode_adv = 0x9,
		.video_prog_mode = 0,
		.video_prog_mode_present = true,
		.video_sync_mode = 7,
		.video_sync_mode_present = true,
		/* video_yc_dly */
		/* video_rgb_ctrl */
		.video_filt_ctrl = 0x2052,
		.video_filt_ctrl_present = true,
		/* video_ofld_voav_ofst */
		.yfp1_hसमय = 244,
		.yfp2_hसमय = 1630,
		.max_pxcnt = 1715,
		.hspuls_begin = 0x22,
		.hspuls_end = 0xa0,
		.hspuls_चयन = 88,
		.vspuls_begin = 0,
		.vspuls_end = 1589,
		.vspuls_bline = 0,
		.vspuls_eline = 5,
		.havon_begin = 249,
		.havon_end = 1689,
		.vavon_bline = 42,
		.vavon_eline = 521,
		/* eqpuls_begin */
		/* eqpuls_end */
		/* eqpuls_bline */
		/* eqpuls_eline */
		.hso_begin = 3,
		.hso_end = 5,
		.vso_begin = 3,
		.vso_end = 5,
		.vso_bline = 0,
		/* vso_eline */
		.sy_val	= 8,
		.sy_val_present = true,
		.sy2_val = 0x1d8,
		.sy2_val_present = true,
		.max_lncnt = 524,
	पूर्ण,
पूर्ण;

जोड़ meson_hdmi_venc_mode meson_hdmi_encp_mode_576p = अणु
	.encp = अणु
		.dvi_settings = 0x21,
		.video_mode = 0x4000,
		.video_mode_adv = 0x9,
		.video_prog_mode = 0,
		.video_prog_mode_present = true,
		.video_sync_mode = 7,
		.video_sync_mode_present = true,
		/* video_yc_dly */
		/* video_rgb_ctrl */
		.video_filt_ctrl = 0x52,
		.video_filt_ctrl_present = true,
		/* video_ofld_voav_ofst */
		.yfp1_hसमय = 235,
		.yfp2_hसमय = 1674,
		.max_pxcnt = 1727,
		.hspuls_begin = 0,
		.hspuls_end = 0x80,
		.hspuls_चयन = 88,
		.vspuls_begin = 0,
		.vspuls_end = 1599,
		.vspuls_bline = 0,
		.vspuls_eline = 4,
		.havon_begin = 235,
		.havon_end = 1674,
		.vavon_bline = 44,
		.vavon_eline = 619,
		/* eqpuls_begin */
		/* eqpuls_end */
		/* eqpuls_bline */
		/* eqpuls_eline */
		.hso_begin = 0x80,
		.hso_end = 0,
		.vso_begin = 0,
		.vso_end = 5,
		.vso_bline = 0,
		/* vso_eline */
		.sy_val	= 8,
		.sy_val_present = true,
		.sy2_val = 0x1d8,
		.sy2_val_present = true,
		.max_lncnt = 624,
	पूर्ण,
पूर्ण;

जोड़ meson_hdmi_venc_mode meson_hdmi_encp_mode_720p60 = अणु
	.encp = अणु
		.dvi_settings = 0x2029,
		.video_mode = 0x4040,
		.video_mode_adv = 0x19,
		/* video_prog_mode */
		/* video_sync_mode */
		/* video_yc_dly */
		/* video_rgb_ctrl */
		/* video_filt_ctrl */
		/* video_ofld_voav_ofst */
		.yfp1_hसमय = 648,
		.yfp2_hसमय = 3207,
		.max_pxcnt = 3299,
		.hspuls_begin = 80,
		.hspuls_end = 240,
		.hspuls_चयन = 80,
		.vspuls_begin = 688,
		.vspuls_end = 3248,
		.vspuls_bline = 4,
		.vspuls_eline = 8,
		.havon_begin = 648,
		.havon_end = 3207,
		.vavon_bline = 29,
		.vavon_eline = 748,
		/* eqpuls_begin */
		/* eqpuls_end */
		/* eqpuls_bline */
		/* eqpuls_eline */
		.hso_begin = 256,
		.hso_end = 168,
		.vso_begin = 168,
		.vso_end = 256,
		.vso_bline = 0,
		.vso_eline = 5,
		.vso_eline_present = true,
		/* sy_val */
		/* sy2_val */
		.max_lncnt = 749,
	पूर्ण,
पूर्ण;

जोड़ meson_hdmi_venc_mode meson_hdmi_encp_mode_720p50 = अणु
	.encp = अणु
		.dvi_settings = 0x202d,
		.video_mode = 0x4040,
		.video_mode_adv = 0x19,
		.video_prog_mode = 0x100,
		.video_prog_mode_present = true,
		.video_sync_mode = 0x407,
		.video_sync_mode_present = true,
		.video_yc_dly = 0,
		.video_yc_dly_present = true,
		/* video_rgb_ctrl */
		/* video_filt_ctrl */
		/* video_ofld_voav_ofst */
		.yfp1_hसमय = 648,
		.yfp2_hसमय = 3207,
		.max_pxcnt = 3959,
		.hspuls_begin = 80,
		.hspuls_end = 240,
		.hspuls_चयन = 80,
		.vspuls_begin = 688,
		.vspuls_end = 3248,
		.vspuls_bline = 4,
		.vspuls_eline = 8,
		.havon_begin = 648,
		.havon_end = 3207,
		.vavon_bline = 29,
		.vavon_eline = 748,
		/* eqpuls_begin */
		/* eqpuls_end */
		/* eqpuls_bline */
		/* eqpuls_eline */
		.hso_begin = 128,
		.hso_end = 208,
		.vso_begin = 128,
		.vso_end = 128,
		.vso_bline = 0,
		.vso_eline = 5,
		.vso_eline_present = true,
		/* sy_val */
		/* sy2_val */
		.max_lncnt = 749,
	पूर्ण,
पूर्ण;

जोड़ meson_hdmi_venc_mode meson_hdmi_encp_mode_1080i60 = अणु
	.encp = अणु
		.dvi_settings = 0x2029,
		.video_mode = 0x5ffc,
		.video_mode_adv = 0x19,
		.video_prog_mode = 0x100,
		.video_prog_mode_present = true,
		.video_sync_mode = 0x207,
		.video_sync_mode_present = true,
		/* video_yc_dly */
		/* video_rgb_ctrl */
		/* video_filt_ctrl */
		.video_ofld_voav_ofst = 0x11,
		.video_ofld_voav_ofst_present = true,
		.yfp1_hसमय = 516,
		.yfp2_hसमय = 4355,
		.max_pxcnt = 4399,
		.hspuls_begin = 88,
		.hspuls_end = 264,
		.hspuls_चयन = 88,
		.vspuls_begin = 440,
		.vspuls_end = 2200,
		.vspuls_bline = 0,
		.vspuls_eline = 4,
		.havon_begin = 516,
		.havon_end = 4355,
		.vavon_bline = 20,
		.vavon_eline = 559,
		.eqpuls_begin = 2288,
		.eqpuls_begin_present = true,
		.eqpuls_end = 2464,
		.eqpuls_end_present = true,
		.eqpuls_bline = 0,
		.eqpuls_bline_present = true,
		.eqpuls_eline = 4,
		.eqpuls_eline_present = true,
		.hso_begin = 264,
		.hso_end = 176,
		.vso_begin = 88,
		.vso_end = 88,
		.vso_bline = 0,
		.vso_eline = 5,
		.vso_eline_present = true,
		/* sy_val */
		/* sy2_val */
		.max_lncnt = 1124,
	पूर्ण,
पूर्ण;

जोड़ meson_hdmi_venc_mode meson_hdmi_encp_mode_1080i50 = अणु
	.encp = अणु
		.dvi_settings = 0x202d,
		.video_mode = 0x5ffc,
		.video_mode_adv = 0x19,
		.video_prog_mode = 0x100,
		.video_prog_mode_present = true,
		.video_sync_mode = 0x7,
		.video_sync_mode_present = true,
		/* video_yc_dly */
		/* video_rgb_ctrl */
		/* video_filt_ctrl */
		.video_ofld_voav_ofst = 0x11,
		.video_ofld_voav_ofst_present = true,
		.yfp1_hसमय = 526,
		.yfp2_hसमय = 4365,
		.max_pxcnt = 5279,
		.hspuls_begin = 88,
		.hspuls_end = 264,
		.hspuls_चयन = 88,
		.vspuls_begin = 440,
		.vspuls_end = 2200,
		.vspuls_bline = 0,
		.vspuls_eline = 4,
		.havon_begin = 526,
		.havon_end = 4365,
		.vavon_bline = 20,
		.vavon_eline = 559,
		.eqpuls_begin = 2288,
		.eqpuls_begin_present = true,
		.eqpuls_end = 2464,
		.eqpuls_end_present = true,
		.eqpuls_bline = 0,
		.eqpuls_bline_present = true,
		.eqpuls_eline = 4,
		.eqpuls_eline_present = true,
		.hso_begin = 142,
		.hso_end = 230,
		.vso_begin = 142,
		.vso_end = 142,
		.vso_bline = 0,
		.vso_eline = 5,
		.vso_eline_present = true,
		/* sy_val */
		/* sy2_val */
		.max_lncnt = 1124,
	पूर्ण,
पूर्ण;

जोड़ meson_hdmi_venc_mode meson_hdmi_encp_mode_1080p24 = अणु
	.encp = अणु
		.dvi_settings = 0xd,
		.video_mode = 0x4040,
		.video_mode_adv = 0x18,
		.video_prog_mode = 0x100,
		.video_prog_mode_present = true,
		.video_sync_mode = 0x7,
		.video_sync_mode_present = true,
		.video_yc_dly = 0,
		.video_yc_dly_present = true,
		.video_rgb_ctrl = 2,
		.video_rgb_ctrl_present = true,
		.video_filt_ctrl = 0x1052,
		.video_filt_ctrl_present = true,
		/* video_ofld_voav_ofst */
		.yfp1_hसमय = 271,
		.yfp2_hसमय = 2190,
		.max_pxcnt = 2749,
		.hspuls_begin = 44,
		.hspuls_end = 132,
		.hspuls_चयन = 44,
		.vspuls_begin = 220,
		.vspuls_end = 2140,
		.vspuls_bline = 0,
		.vspuls_eline = 4,
		.havon_begin = 271,
		.havon_end = 2190,
		.vavon_bline = 41,
		.vavon_eline = 1120,
		/* eqpuls_begin */
		/* eqpuls_end */
		.eqpuls_bline = 0,
		.eqpuls_bline_present = true,
		.eqpuls_eline = 4,
		.eqpuls_eline_present = true,
		.hso_begin = 79,
		.hso_end = 123,
		.vso_begin = 79,
		.vso_end = 79,
		.vso_bline = 0,
		.vso_eline = 5,
		.vso_eline_present = true,
		/* sy_val */
		/* sy2_val */
		.max_lncnt = 1124,
	पूर्ण,
पूर्ण;

जोड़ meson_hdmi_venc_mode meson_hdmi_encp_mode_1080p30 = अणु
	.encp = अणु
		.dvi_settings = 0x1,
		.video_mode = 0x4040,
		.video_mode_adv = 0x18,
		.video_prog_mode = 0x100,
		.video_prog_mode_present = true,
		/* video_sync_mode */
		/* video_yc_dly */
		/* video_rgb_ctrl */
		.video_filt_ctrl = 0x1052,
		.video_filt_ctrl_present = true,
		/* video_ofld_voav_ofst */
		.yfp1_hसमय = 140,
		.yfp2_hसमय = 2060,
		.max_pxcnt = 2199,
		.hspuls_begin = 2156,
		.hspuls_end = 44,
		.hspuls_चयन = 44,
		.vspuls_begin = 140,
		.vspuls_end = 2059,
		.vspuls_bline = 0,
		.vspuls_eline = 4,
		.havon_begin = 148,
		.havon_end = 2067,
		.vavon_bline = 41,
		.vavon_eline = 1120,
		/* eqpuls_begin */
		/* eqpuls_end */
		/* eqpuls_bline */
		/* eqpuls_eline */
		.hso_begin = 44,
		.hso_end = 2156,
		.vso_begin = 2100,
		.vso_end = 2164,
		.vso_bline = 0,
		.vso_eline = 5,
		.vso_eline_present = true,
		/* sy_val */
		/* sy2_val */
		.max_lncnt = 1124,
	पूर्ण,
पूर्ण;

जोड़ meson_hdmi_venc_mode meson_hdmi_encp_mode_1080p50 = अणु
	.encp = अणु
		.dvi_settings = 0xd,
		.video_mode = 0x4040,
		.video_mode_adv = 0x18,
		.video_prog_mode = 0x100,
		.video_prog_mode_present = true,
		.video_sync_mode = 0x7,
		.video_sync_mode_present = true,
		.video_yc_dly = 0,
		.video_yc_dly_present = true,
		.video_rgb_ctrl = 2,
		.video_rgb_ctrl_present = true,
		/* video_filt_ctrl */
		/* video_ofld_voav_ofst */
		.yfp1_hसमय = 271,
		.yfp2_hसमय = 2190,
		.max_pxcnt = 2639,
		.hspuls_begin = 44,
		.hspuls_end = 132,
		.hspuls_चयन = 44,
		.vspuls_begin = 220,
		.vspuls_end = 2140,
		.vspuls_bline = 0,
		.vspuls_eline = 4,
		.havon_begin = 271,
		.havon_end = 2190,
		.vavon_bline = 41,
		.vavon_eline = 1120,
		/* eqpuls_begin */
		/* eqpuls_end */
		.eqpuls_bline = 0,
		.eqpuls_bline_present = true,
		.eqpuls_eline = 4,
		.eqpuls_eline_present = true,
		.hso_begin = 79,
		.hso_end = 123,
		.vso_begin = 79,
		.vso_end = 79,
		.vso_bline = 0,
		.vso_eline = 5,
		.vso_eline_present = true,
		/* sy_val */
		/* sy2_val */
		.max_lncnt = 1124,
	पूर्ण,
पूर्ण;

जोड़ meson_hdmi_venc_mode meson_hdmi_encp_mode_1080p60 = अणु
	.encp = अणु
		.dvi_settings = 0x1,
		.video_mode = 0x4040,
		.video_mode_adv = 0x18,
		.video_prog_mode = 0x100,
		.video_prog_mode_present = true,
		/* video_sync_mode */
		/* video_yc_dly */
		/* video_rgb_ctrl */
		.video_filt_ctrl = 0x1052,
		.video_filt_ctrl_present = true,
		/* video_ofld_voav_ofst */
		.yfp1_hसमय = 140,
		.yfp2_hसमय = 2060,
		.max_pxcnt = 2199,
		.hspuls_begin = 2156,
		.hspuls_end = 44,
		.hspuls_चयन = 44,
		.vspuls_begin = 140,
		.vspuls_end = 2059,
		.vspuls_bline = 0,
		.vspuls_eline = 4,
		.havon_begin = 148,
		.havon_end = 2067,
		.vavon_bline = 41,
		.vavon_eline = 1120,
		/* eqpuls_begin */
		/* eqpuls_end */
		/* eqpuls_bline */
		/* eqpuls_eline */
		.hso_begin = 44,
		.hso_end = 2156,
		.vso_begin = 2100,
		.vso_end = 2164,
		.vso_bline = 0,
		.vso_eline = 5,
		.vso_eline_present = true,
		/* sy_val */
		/* sy2_val */
		.max_lncnt = 1124,
	पूर्ण,
पूर्ण;

जोड़ meson_hdmi_venc_mode meson_hdmi_encp_mode_2160p24 = अणु
	.encp = अणु
		.dvi_settings = 0x1,
		.video_mode = 0x4040,
		.video_mode_adv = 0x8,
		/* video_sync_mode */
		/* video_yc_dly */
		/* video_rgb_ctrl */
		.video_filt_ctrl = 0x1000,
		.video_filt_ctrl_present = true,
		/* video_ofld_voav_ofst */
		.yfp1_hसमय = 140,
		.yfp2_hसमय = 140+3840,
		.max_pxcnt = 3840+1660-1,
		.hspuls_begin = 2156+1920,
		.hspuls_end = 44,
		.hspuls_चयन = 44,
		.vspuls_begin = 140,
		.vspuls_end = 2059+1920,
		.vspuls_bline = 0,
		.vspuls_eline = 4,
		.havon_begin = 148,
		.havon_end = 3987,
		.vavon_bline = 89,
		.vavon_eline = 2248,
		/* eqpuls_begin */
		/* eqpuls_end */
		/* eqpuls_bline */
		/* eqpuls_eline */
		.hso_begin = 44,
		.hso_end = 2156+1920,
		.vso_begin = 2100+1920,
		.vso_end = 2164+1920,
		.vso_bline = 51,
		.vso_eline = 53,
		.vso_eline_present = true,
		/* sy_val */
		/* sy2_val */
		.max_lncnt = 2249,
	पूर्ण,
पूर्ण;

जोड़ meson_hdmi_venc_mode meson_hdmi_encp_mode_2160p25 = अणु
	.encp = अणु
		.dvi_settings = 0x1,
		.video_mode = 0x4040,
		.video_mode_adv = 0x8,
		/* video_sync_mode */
		/* video_yc_dly */
		/* video_rgb_ctrl */
		.video_filt_ctrl = 0x1000,
		.video_filt_ctrl_present = true,
		/* video_ofld_voav_ofst */
		.yfp1_hसमय = 140,
		.yfp2_hसमय = 140+3840,
		.max_pxcnt = 3840+1440-1,
		.hspuls_begin = 2156+1920,
		.hspuls_end = 44,
		.hspuls_चयन = 44,
		.vspuls_begin = 140,
		.vspuls_end = 2059+1920,
		.vspuls_bline = 0,
		.vspuls_eline = 4,
		.havon_begin = 148,
		.havon_end = 3987,
		.vavon_bline = 89,
		.vavon_eline = 2248,
		/* eqpuls_begin */
		/* eqpuls_end */
		/* eqpuls_bline */
		/* eqpuls_eline */
		.hso_begin = 44,
		.hso_end = 2156+1920,
		.vso_begin = 2100+1920,
		.vso_end = 2164+1920,
		.vso_bline = 51,
		.vso_eline = 53,
		.vso_eline_present = true,
		/* sy_val */
		/* sy2_val */
		.max_lncnt = 2249,
	पूर्ण,
पूर्ण;

जोड़ meson_hdmi_venc_mode meson_hdmi_encp_mode_2160p30 = अणु
	.encp = अणु
		.dvi_settings = 0x1,
		.video_mode = 0x4040,
		.video_mode_adv = 0x8,
		/* video_sync_mode */
		/* video_yc_dly */
		/* video_rgb_ctrl */
		.video_filt_ctrl = 0x1000,
		.video_filt_ctrl_present = true,
		/* video_ofld_voav_ofst */
		.yfp1_hसमय = 140,
		.yfp2_hसमय = 140+3840,
		.max_pxcnt = 3840+560-1,
		.hspuls_begin = 2156+1920,
		.hspuls_end = 44,
		.hspuls_चयन = 44,
		.vspuls_begin = 140,
		.vspuls_end = 2059+1920,
		.vspuls_bline = 0,
		.vspuls_eline = 4,
		.havon_begin = 148,
		.havon_end = 3987,
		.vavon_bline = 89,
		.vavon_eline = 2248,
		/* eqpuls_begin */
		/* eqpuls_end */
		/* eqpuls_bline */
		/* eqpuls_eline */
		.hso_begin = 44,
		.hso_end = 2156+1920,
		.vso_begin = 2100+1920,
		.vso_end = 2164+1920,
		.vso_bline = 51,
		.vso_eline = 53,
		.vso_eline_present = true,
		/* sy_val */
		/* sy2_val */
		.max_lncnt = 2249,
	पूर्ण,
पूर्ण;

काष्ठा meson_hdmi_venc_vic_mode अणु
	अचिन्हित पूर्णांक vic;
	जोड़ meson_hdmi_venc_mode *mode;
पूर्ण meson_hdmi_venc_vic_modes[] = अणु
	अणु 6, &meson_hdmi_enci_mode_480i पूर्ण,
	अणु 7, &meson_hdmi_enci_mode_480i पूर्ण,
	अणु 21, &meson_hdmi_enci_mode_576i पूर्ण,
	अणु 22, &meson_hdmi_enci_mode_576i पूर्ण,
	अणु 2, &meson_hdmi_encp_mode_480p पूर्ण,
	अणु 3, &meson_hdmi_encp_mode_480p पूर्ण,
	अणु 17, &meson_hdmi_encp_mode_576p पूर्ण,
	अणु 18, &meson_hdmi_encp_mode_576p पूर्ण,
	अणु 4, &meson_hdmi_encp_mode_720p60 पूर्ण,
	अणु 19, &meson_hdmi_encp_mode_720p50 पूर्ण,
	अणु 5, &meson_hdmi_encp_mode_1080i60 पूर्ण,
	अणु 20, &meson_hdmi_encp_mode_1080i50 पूर्ण,
	अणु 32, &meson_hdmi_encp_mode_1080p24 पूर्ण,
	अणु 33, &meson_hdmi_encp_mode_1080p50 पूर्ण,
	अणु 34, &meson_hdmi_encp_mode_1080p30 पूर्ण,
	अणु 31, &meson_hdmi_encp_mode_1080p50 पूर्ण,
	अणु 16, &meson_hdmi_encp_mode_1080p60 पूर्ण,
	अणु 93, &meson_hdmi_encp_mode_2160p24 पूर्ण,
	अणु 94, &meson_hdmi_encp_mode_2160p25 पूर्ण,
	अणु 95, &meson_hdmi_encp_mode_2160p30 पूर्ण,
	अणु 96, &meson_hdmi_encp_mode_2160p25 पूर्ण,
	अणु 97, &meson_hdmi_encp_mode_2160p30 पूर्ण,
	अणु 0, शून्यपूर्ण, /* sentinel */
पूर्ण;

अटल चिन्हित पूर्णांक to_चिन्हित(अचिन्हित पूर्णांक a)
अणु
	अगर (a <= 7)
		वापस a;
	अन्यथा
		वापस a - 16;
पूर्ण

अटल अचिन्हित दीर्घ modulo(अचिन्हित दीर्घ a, अचिन्हित दीर्घ b)
अणु
	अगर (a >= b)
		वापस a - b;
	अन्यथा
		वापस a;
पूर्ण

क्रमागत drm_mode_status
meson_venc_hdmi_supported_mode(स्थिर काष्ठा drm_display_mode *mode)
अणु
	अगर (mode->flags & ~(DRM_MODE_FLAG_PHSYNC | DRM_MODE_FLAG_NHSYNC |
			    DRM_MODE_FLAG_PVSYNC | DRM_MODE_FLAG_NVSYNC))
		वापस MODE_BAD;

	अगर (mode->hdisplay < 640 || mode->hdisplay > 1920)
		वापस MODE_BAD_HVALUE;

	अगर (mode->vdisplay < 480 || mode->vdisplay > 1200)
		वापस MODE_BAD_VVALUE;

	वापस MODE_OK;
पूर्ण
EXPORT_SYMBOL_GPL(meson_venc_hdmi_supported_mode);

bool meson_venc_hdmi_supported_vic(पूर्णांक vic)
अणु
	काष्ठा meson_hdmi_venc_vic_mode *vmode = meson_hdmi_venc_vic_modes;

	जबतक (vmode->vic && vmode->mode) अणु
		अगर (vmode->vic == vic)
			वापस true;
		vmode++;
	पूर्ण

	वापस false;
पूर्ण
EXPORT_SYMBOL_GPL(meson_venc_hdmi_supported_vic);

अटल व्योम meson_venc_hdmi_get_dmt_vmode(स्थिर काष्ठा drm_display_mode *mode,
					  जोड़ meson_hdmi_venc_mode *dmt_mode)
अणु
	स_रखो(dmt_mode, 0, माप(*dmt_mode));

	dmt_mode->encp.dvi_settings = 0x21;
	dmt_mode->encp.video_mode = 0x4040;
	dmt_mode->encp.video_mode_adv = 0x18;
	dmt_mode->encp.max_pxcnt = mode->htotal - 1;
	dmt_mode->encp.havon_begin = mode->htotal - mode->hsync_start;
	dmt_mode->encp.havon_end = dmt_mode->encp.havon_begin +
				   mode->hdisplay - 1;
	dmt_mode->encp.vavon_bline = mode->vtotal - mode->vsync_start;
	dmt_mode->encp.vavon_eline = dmt_mode->encp.vavon_bline +
				     mode->vdisplay - 1;
	dmt_mode->encp.hso_begin = 0;
	dmt_mode->encp.hso_end = mode->hsync_end - mode->hsync_start;
	dmt_mode->encp.vso_begin = 30;
	dmt_mode->encp.vso_end = 50;
	dmt_mode->encp.vso_bline = 0;
	dmt_mode->encp.vso_eline = mode->vsync_end - mode->vsync_start;
	dmt_mode->encp.vso_eline_present = true;
	dmt_mode->encp.max_lncnt = mode->vtotal - 1;
पूर्ण

अटल जोड़ meson_hdmi_venc_mode *meson_venc_hdmi_get_vic_vmode(पूर्णांक vic)
अणु
	काष्ठा meson_hdmi_venc_vic_mode *vmode = meson_hdmi_venc_vic_modes;

	जबतक (vmode->vic && vmode->mode) अणु
		अगर (vmode->vic == vic)
			वापस vmode->mode;
		vmode++;
	पूर्ण

	वापस शून्य;
पूर्ण

bool meson_venc_hdmi_venc_repeat(पूर्णांक vic)
अणु
	/* Repeat VENC pixels क्रम 480/576i/p, 720p50/60 and 1080p50/60 */
	अगर (vic == 6 || vic == 7 || /* 480i */
	    vic == 21 || vic == 22 || /* 576i */
	    vic == 17 || vic == 18 || /* 576p */
	    vic == 2 || vic == 3 || /* 480p */
	    vic == 4 || /* 720p60 */
	    vic == 19 || /* 720p50 */
	    vic == 5 || /* 1080i60 */
	    vic == 20)	/* 1080i50 */
		वापस true;

	वापस false;
पूर्ण
EXPORT_SYMBOL_GPL(meson_venc_hdmi_venc_repeat);

व्योम meson_venc_hdmi_mode_set(काष्ठा meson_drm *priv, पूर्णांक vic,
			      अचिन्हित पूर्णांक ycrcb_map,
			      bool yuv420_mode,
			      स्थिर काष्ठा drm_display_mode *mode)
अणु
	जोड़ meson_hdmi_venc_mode *vmode = शून्य;
	जोड़ meson_hdmi_venc_mode vmode_dmt;
	bool use_enci = false;
	bool venc_repeat = false;
	bool hdmi_repeat = false;
	अचिन्हित पूर्णांक venc_hdmi_latency = 2;
	अचिन्हित दीर्घ total_pixels_venc = 0;
	अचिन्हित दीर्घ active_pixels_venc = 0;
	अचिन्हित दीर्घ front_porch_venc = 0;
	अचिन्हित दीर्घ hsync_pixels_venc = 0;
	अचिन्हित दीर्घ de_h_begin = 0;
	अचिन्हित दीर्घ de_h_end = 0;
	अचिन्हित दीर्घ de_v_begin_even = 0;
	अचिन्हित दीर्घ de_v_end_even = 0;
	अचिन्हित दीर्घ de_v_begin_odd = 0;
	अचिन्हित दीर्घ de_v_end_odd = 0;
	अचिन्हित दीर्घ hs_begin = 0;
	अचिन्हित दीर्घ hs_end = 0;
	अचिन्हित दीर्घ vs_adjust = 0;
	अचिन्हित दीर्घ vs_bline_evn = 0;
	अचिन्हित दीर्घ vs_eline_evn = 0;
	अचिन्हित दीर्घ vs_bline_odd = 0;
	अचिन्हित दीर्घ vs_eline_odd = 0;
	अचिन्हित दीर्घ vso_begin_evn = 0;
	अचिन्हित दीर्घ vso_begin_odd = 0;
	अचिन्हित पूर्णांक eof_lines;
	अचिन्हित पूर्णांक sof_lines;
	अचिन्हित पूर्णांक vsync_lines;
	u32 reg;

	/* Use VENCI क्रम 480i and 576i and द्विगुन HDMI pixels */
	अगर (mode->flags & DRM_MODE_FLAG_DBLCLK) अणु
		hdmi_repeat = true;
		use_enci = true;
		venc_hdmi_latency = 1;
	पूर्ण

	अगर (meson_venc_hdmi_supported_vic(vic)) अणु
		vmode = meson_venc_hdmi_get_vic_vmode(vic);
		अगर (!vmode) अणु
			dev_err(priv->dev, "%s: Fatal Error, unsupported mode "
				DRM_MODE_FMT "\n", __func__,
				DRM_MODE_ARG(mode));
			वापस;
		पूर्ण
	पूर्ण अन्यथा अणु
		meson_venc_hdmi_get_dmt_vmode(mode, &vmode_dmt);
		vmode = &vmode_dmt;
		use_enci = false;
	पूर्ण

	/* Repeat VENC pixels क्रम 480/576i/p, 720p50/60 and 1080p50/60 */
	अगर (meson_venc_hdmi_venc_repeat(vic))
		venc_repeat = true;

	eof_lines = mode->vsync_start - mode->vdisplay;
	अगर (mode->flags & DRM_MODE_FLAG_INTERLACE)
		eof_lines /= 2;
	sof_lines = mode->vtotal - mode->vsync_end;
	अगर (mode->flags & DRM_MODE_FLAG_INTERLACE)
		sof_lines /= 2;
	vsync_lines = mode->vsync_end - mode->vsync_start;
	अगर (mode->flags & DRM_MODE_FLAG_INTERLACE)
		vsync_lines /= 2;

	total_pixels_venc = mode->htotal;
	अगर (hdmi_repeat)
		total_pixels_venc /= 2;
	अगर (venc_repeat)
		total_pixels_venc *= 2;

	active_pixels_venc = mode->hdisplay;
	अगर (hdmi_repeat)
		active_pixels_venc /= 2;
	अगर (venc_repeat)
		active_pixels_venc *= 2;

	front_porch_venc = (mode->hsync_start - mode->hdisplay);
	अगर (hdmi_repeat)
		front_porch_venc /= 2;
	अगर (venc_repeat)
		front_porch_venc *= 2;

	hsync_pixels_venc = (mode->hsync_end - mode->hsync_start);
	अगर (hdmi_repeat)
		hsync_pixels_venc /= 2;
	अगर (venc_repeat)
		hsync_pixels_venc *= 2;

	/* Disable VDACs */
	ग_लिखोl_bits_relaxed(0xff, 0xff,
			priv->io_base + _REG(VENC_VDAC_SETTING));

	ग_लिखोl_relaxed(0, priv->io_base + _REG(ENCI_VIDEO_EN));
	ग_लिखोl_relaxed(0, priv->io_base + _REG(ENCP_VIDEO_EN));

	अगर (use_enci) अणु
		अचिन्हित पूर्णांक lines_f0;
		अचिन्हित पूर्णांक lines_f1;

		/* CVBS Filter settings */
		ग_लिखोl_relaxed(ENCI_CFILT_CMPT_SEL_HIGH | 0x10,
			       priv->io_base + _REG(ENCI_CFILT_CTRL));
		ग_लिखोl_relaxed(ENCI_CFILT_CMPT_CR_DLY(2) |
			       ENCI_CFILT_CMPT_CB_DLY(1),
			       priv->io_base + _REG(ENCI_CFILT_CTRL2));

		/* Digital Video Select : Interlace, clk27 clk, बाह्यal */
		ग_लिखोl_relaxed(0, priv->io_base + _REG(VENC_DVI_SETTING));

		/* Reset Video Mode */
		ग_लिखोl_relaxed(0, priv->io_base + _REG(ENCI_VIDEO_MODE));
		ग_लिखोl_relaxed(0, priv->io_base + _REG(ENCI_VIDEO_MODE_ADV));

		/* Horizontal sync संकेत output */
		ग_लिखोl_relaxed(vmode->enci.hso_begin,
				priv->io_base + _REG(ENCI_SYNC_HSO_BEGIN));
		ग_लिखोl_relaxed(vmode->enci.hso_end,
				priv->io_base + _REG(ENCI_SYNC_HSO_END));

		/* Vertical Sync lines */
		ग_लिखोl_relaxed(vmode->enci.vso_even,
				priv->io_base + _REG(ENCI_SYNC_VSO_EVNLN));
		ग_लिखोl_relaxed(vmode->enci.vso_odd,
				priv->io_base + _REG(ENCI_SYNC_VSO_ODDLN));

		/* Macrovision max amplitude change */
		ग_लिखोl_relaxed(ENCI_MACV_MAX_AMP_ENABLE_CHANGE |
			       ENCI_MACV_MAX_AMP_VAL(vmode->enci.macv_max_amp),
			       priv->io_base + _REG(ENCI_MACV_MAX_AMP));

		/* Video mode */
		ग_लिखोl_relaxed(vmode->enci.video_prog_mode,
				priv->io_base + _REG(VENC_VIDEO_PROG_MODE));
		ग_लिखोl_relaxed(vmode->enci.video_mode,
				priv->io_base + _REG(ENCI_VIDEO_MODE));

		/*
		 * Advanced Video Mode :
		 * Demux shअगरting 0x2
		 * Blank line end at line17/22
		 * High bandwidth Luma Filter
		 * Low bandwidth Chroma Filter
		 * Bypass luma low pass filter
		 * No macrovision on CSYNC
		 */
		ग_लिखोl_relaxed(ENCI_VIDEO_MODE_ADV_DMXMD(2) |
			       ENCI_VIDEO_MODE_ADV_VBICTL_LINE_17_22 |
			       ENCI_VIDEO_MODE_ADV_YBW_HIGH,
			       priv->io_base + _REG(ENCI_VIDEO_MODE_ADV));

		ग_लिखोl(vmode->enci.sch_adjust,
				priv->io_base + _REG(ENCI_VIDEO_SCH));

		/* Sync mode : MASTER Master mode, मुक्त run, send HSO/VSO out */
		ग_लिखोl_relaxed(0x07, priv->io_base + _REG(ENCI_SYNC_MODE));

		अगर (vmode->enci.yc_delay)
			ग_लिखोl_relaxed(vmode->enci.yc_delay,
					priv->io_base + _REG(ENCI_YC_DELAY));


		/* UNreset Interlaced TV Encoder */
		ग_लिखोl_relaxed(0, priv->io_base + _REG(ENCI_DBG_PX_RST));

		/*
		 * Enable Vfअगरo2vd and set Y_Cb_Y_Cr:
		 * Corresponding value:
		 * Y  => 00 or 10
		 * Cb => 01
		 * Cr => 11
		 * Ex: 0x4e => 01001110 would mean Cb/Y/Cr/Y
		 */
		ग_लिखोl_relaxed(ENCI_VFIFO2VD_CTL_ENABLE |
			       ENCI_VFIFO2VD_CTL_VD_SEL(0x4e),
			       priv->io_base + _REG(ENCI_VFIFO2VD_CTL));

		/* Timings */
		ग_लिखोl_relaxed(vmode->enci.pixel_start,
			priv->io_base + _REG(ENCI_VFIFO2VD_PIXEL_START));
		ग_लिखोl_relaxed(vmode->enci.pixel_end,
			priv->io_base + _REG(ENCI_VFIFO2VD_PIXEL_END));

		ग_लिखोl_relaxed(vmode->enci.top_field_line_start,
			priv->io_base + _REG(ENCI_VFIFO2VD_LINE_TOP_START));
		ग_लिखोl_relaxed(vmode->enci.top_field_line_end,
			priv->io_base + _REG(ENCI_VFIFO2VD_LINE_TOP_END));

		ग_लिखोl_relaxed(vmode->enci.bottom_field_line_start,
			priv->io_base + _REG(ENCI_VFIFO2VD_LINE_BOT_START));
		ग_लिखोl_relaxed(vmode->enci.bottom_field_line_end,
			priv->io_base + _REG(ENCI_VFIFO2VD_LINE_BOT_END));

		/* Select ENCI क्रम VIU */
		meson_vpp_setup_mux(priv, MESON_VIU_VPP_MUX_ENCI);

		/* Interlace video enable */
		ग_लिखोl_relaxed(ENCI_VIDEO_EN_ENABLE,
			       priv->io_base + _REG(ENCI_VIDEO_EN));

		lines_f0 = mode->vtotal >> 1;
		lines_f1 = lines_f0 + 1;

		de_h_begin = modulo(पढ़ोl_relaxed(priv->io_base +
					_REG(ENCI_VFIFO2VD_PIXEL_START))
					+ venc_hdmi_latency,
				    total_pixels_venc);
		de_h_end  = modulo(de_h_begin + active_pixels_venc,
				   total_pixels_venc);

		ग_लिखोl_relaxed(de_h_begin,
				priv->io_base + _REG(ENCI_DE_H_BEGIN));
		ग_लिखोl_relaxed(de_h_end,
				priv->io_base + _REG(ENCI_DE_H_END));

		de_v_begin_even = पढ़ोl_relaxed(priv->io_base +
					_REG(ENCI_VFIFO2VD_LINE_TOP_START));
		de_v_end_even  = de_v_begin_even + mode->vdisplay;
		de_v_begin_odd = पढ़ोl_relaxed(priv->io_base +
					_REG(ENCI_VFIFO2VD_LINE_BOT_START));
		de_v_end_odd = de_v_begin_odd + mode->vdisplay;

		ग_लिखोl_relaxed(de_v_begin_even,
				priv->io_base + _REG(ENCI_DE_V_BEGIN_EVEN));
		ग_लिखोl_relaxed(de_v_end_even,
				priv->io_base + _REG(ENCI_DE_V_END_EVEN));
		ग_लिखोl_relaxed(de_v_begin_odd,
				priv->io_base + _REG(ENCI_DE_V_BEGIN_ODD));
		ग_लिखोl_relaxed(de_v_end_odd,
				priv->io_base + _REG(ENCI_DE_V_END_ODD));

		/* Program Hsync timing */
		hs_begin = de_h_end + front_porch_venc;
		अगर (de_h_end + front_porch_venc >= total_pixels_venc) अणु
			hs_begin -= total_pixels_venc;
			vs_adjust  = 1;
		पूर्ण अन्यथा अणु
			hs_begin = de_h_end + front_porch_venc;
			vs_adjust  = 0;
		पूर्ण

		hs_end = modulo(hs_begin + hsync_pixels_venc,
				total_pixels_venc);
		ग_लिखोl_relaxed(hs_begin,
				priv->io_base + _REG(ENCI_DVI_HSO_BEGIN));
		ग_लिखोl_relaxed(hs_end,
				priv->io_base + _REG(ENCI_DVI_HSO_END));

		/* Program Vsync timing क्रम even field */
		अगर (((de_v_end_odd - 1) + eof_lines + vs_adjust) >= lines_f1) अणु
			vs_bline_evn = (de_v_end_odd - 1)
					+ eof_lines
					+ vs_adjust
					- lines_f1;
			vs_eline_evn = vs_bline_evn + vsync_lines;

			ग_लिखोl_relaxed(vs_bline_evn,
				priv->io_base + _REG(ENCI_DVI_VSO_BLINE_EVN));

			ग_लिखोl_relaxed(vs_eline_evn,
				priv->io_base + _REG(ENCI_DVI_VSO_ELINE_EVN));

			ग_लिखोl_relaxed(hs_begin,
				priv->io_base + _REG(ENCI_DVI_VSO_BEGIN_EVN));
			ग_लिखोl_relaxed(hs_begin,
				priv->io_base + _REG(ENCI_DVI_VSO_END_EVN));
		पूर्ण अन्यथा अणु
			vs_bline_odd = (de_v_end_odd - 1)
					+ eof_lines
					+ vs_adjust;

			ग_लिखोl_relaxed(vs_bline_odd,
				priv->io_base + _REG(ENCI_DVI_VSO_BLINE_ODD));

			ग_लिखोl_relaxed(hs_begin,
				priv->io_base + _REG(ENCI_DVI_VSO_BEGIN_ODD));

			अगर ((vs_bline_odd + vsync_lines) >= lines_f1) अणु
				vs_eline_evn = vs_bline_odd
						+ vsync_lines
						- lines_f1;

				ग_लिखोl_relaxed(vs_eline_evn, priv->io_base
						+ _REG(ENCI_DVI_VSO_ELINE_EVN));

				ग_लिखोl_relaxed(hs_begin, priv->io_base
						+ _REG(ENCI_DVI_VSO_END_EVN));
			पूर्ण अन्यथा अणु
				vs_eline_odd = vs_bline_odd
						+ vsync_lines;

				ग_लिखोl_relaxed(vs_eline_odd, priv->io_base
						+ _REG(ENCI_DVI_VSO_ELINE_ODD));

				ग_लिखोl_relaxed(hs_begin, priv->io_base
						+ _REG(ENCI_DVI_VSO_END_ODD));
			पूर्ण
		पूर्ण

		/* Program Vsync timing क्रम odd field */
		अगर (((de_v_end_even - 1) + (eof_lines + 1)) >= lines_f0) अणु
			vs_bline_odd = (de_v_end_even - 1)
					+ (eof_lines + 1)
					- lines_f0;
			vs_eline_odd = vs_bline_odd + vsync_lines;

			ग_लिखोl_relaxed(vs_bline_odd,
				priv->io_base + _REG(ENCI_DVI_VSO_BLINE_ODD));

			ग_लिखोl_relaxed(vs_eline_odd,
				priv->io_base + _REG(ENCI_DVI_VSO_ELINE_ODD));

			vso_begin_odd  = modulo(hs_begin
						+ (total_pixels_venc >> 1),
						total_pixels_venc);

			ग_लिखोl_relaxed(vso_begin_odd,
				priv->io_base + _REG(ENCI_DVI_VSO_BEGIN_ODD));
			ग_लिखोl_relaxed(vso_begin_odd,
				priv->io_base + _REG(ENCI_DVI_VSO_END_ODD));
		पूर्ण अन्यथा अणु
			vs_bline_evn = (de_v_end_even - 1)
					+ (eof_lines + 1);

			ग_लिखोl_relaxed(vs_bline_evn,
				priv->io_base + _REG(ENCI_DVI_VSO_BLINE_EVN));

			vso_begin_evn  = modulo(hs_begin
						+ (total_pixels_venc >> 1),
						total_pixels_venc);

			ग_लिखोl_relaxed(vso_begin_evn, priv->io_base
					+ _REG(ENCI_DVI_VSO_BEGIN_EVN));

			अगर (vs_bline_evn + vsync_lines >= lines_f0) अणु
				vs_eline_odd = vs_bline_evn
						+ vsync_lines
						- lines_f0;

				ग_लिखोl_relaxed(vs_eline_odd, priv->io_base
						+ _REG(ENCI_DVI_VSO_ELINE_ODD));

				ग_लिखोl_relaxed(vso_begin_evn, priv->io_base
						+ _REG(ENCI_DVI_VSO_END_ODD));
			पूर्ण अन्यथा अणु
				vs_eline_evn = vs_bline_evn + vsync_lines;

				ग_लिखोl_relaxed(vs_eline_evn, priv->io_base
						+ _REG(ENCI_DVI_VSO_ELINE_EVN));

				ग_लिखोl_relaxed(vso_begin_evn, priv->io_base
						+ _REG(ENCI_DVI_VSO_END_EVN));
			पूर्ण
		पूर्ण
	पूर्ण अन्यथा अणु
		ग_लिखोl_relaxed(vmode->encp.dvi_settings,
				priv->io_base + _REG(VENC_DVI_SETTING));
		ग_लिखोl_relaxed(vmode->encp.video_mode,
				priv->io_base + _REG(ENCP_VIDEO_MODE));
		ग_लिखोl_relaxed(vmode->encp.video_mode_adv,
				priv->io_base + _REG(ENCP_VIDEO_MODE_ADV));
		अगर (vmode->encp.video_prog_mode_present)
			ग_लिखोl_relaxed(vmode->encp.video_prog_mode,
				priv->io_base + _REG(VENC_VIDEO_PROG_MODE));
		अगर (vmode->encp.video_sync_mode_present)
			ग_लिखोl_relaxed(vmode->encp.video_sync_mode,
				priv->io_base + _REG(ENCP_VIDEO_SYNC_MODE));
		अगर (vmode->encp.video_yc_dly_present)
			ग_लिखोl_relaxed(vmode->encp.video_yc_dly,
				priv->io_base + _REG(ENCP_VIDEO_YC_DLY));
		अगर (vmode->encp.video_rgb_ctrl_present)
			ग_लिखोl_relaxed(vmode->encp.video_rgb_ctrl,
				priv->io_base + _REG(ENCP_VIDEO_RGB_CTRL));
		अगर (vmode->encp.video_filt_ctrl_present)
			ग_लिखोl_relaxed(vmode->encp.video_filt_ctrl,
				priv->io_base + _REG(ENCP_VIDEO_FILT_CTRL));
		अगर (vmode->encp.video_ofld_voav_ofst_present)
			ग_लिखोl_relaxed(vmode->encp.video_ofld_voav_ofst,
				priv->io_base
				+ _REG(ENCP_VIDEO_OFLD_VOAV_OFST));
		ग_लिखोl_relaxed(vmode->encp.yfp1_hसमय,
				priv->io_base + _REG(ENCP_VIDEO_YFP1_HTIME));
		ग_लिखोl_relaxed(vmode->encp.yfp2_hसमय,
				priv->io_base + _REG(ENCP_VIDEO_YFP2_HTIME));
		ग_लिखोl_relaxed(vmode->encp.max_pxcnt,
				priv->io_base + _REG(ENCP_VIDEO_MAX_PXCNT));
		ग_लिखोl_relaxed(vmode->encp.hspuls_begin,
				priv->io_base + _REG(ENCP_VIDEO_HSPULS_BEGIN));
		ग_लिखोl_relaxed(vmode->encp.hspuls_end,
				priv->io_base + _REG(ENCP_VIDEO_HSPULS_END));
		ग_लिखोl_relaxed(vmode->encp.hspuls_चयन,
				priv->io_base + _REG(ENCP_VIDEO_HSPULS_SWITCH));
		ग_लिखोl_relaxed(vmode->encp.vspuls_begin,
				priv->io_base + _REG(ENCP_VIDEO_VSPULS_BEGIN));
		ग_लिखोl_relaxed(vmode->encp.vspuls_end,
				priv->io_base + _REG(ENCP_VIDEO_VSPULS_END));
		ग_लिखोl_relaxed(vmode->encp.vspuls_bline,
				priv->io_base + _REG(ENCP_VIDEO_VSPULS_BLINE));
		ग_लिखोl_relaxed(vmode->encp.vspuls_eline,
				priv->io_base + _REG(ENCP_VIDEO_VSPULS_ELINE));
		अगर (vmode->encp.eqpuls_begin_present)
			ग_लिखोl_relaxed(vmode->encp.eqpuls_begin,
				priv->io_base + _REG(ENCP_VIDEO_EQPULS_BEGIN));
		अगर (vmode->encp.eqpuls_end_present)
			ग_लिखोl_relaxed(vmode->encp.eqpuls_end,
				priv->io_base + _REG(ENCP_VIDEO_EQPULS_END));
		अगर (vmode->encp.eqpuls_bline_present)
			ग_लिखोl_relaxed(vmode->encp.eqpuls_bline,
				priv->io_base + _REG(ENCP_VIDEO_EQPULS_BLINE));
		अगर (vmode->encp.eqpuls_eline_present)
			ग_लिखोl_relaxed(vmode->encp.eqpuls_eline,
				priv->io_base + _REG(ENCP_VIDEO_EQPULS_ELINE));
		ग_लिखोl_relaxed(vmode->encp.havon_begin,
				priv->io_base + _REG(ENCP_VIDEO_HAVON_BEGIN));
		ग_लिखोl_relaxed(vmode->encp.havon_end,
				priv->io_base + _REG(ENCP_VIDEO_HAVON_END));
		ग_लिखोl_relaxed(vmode->encp.vavon_bline,
				priv->io_base + _REG(ENCP_VIDEO_VAVON_BLINE));
		ग_लिखोl_relaxed(vmode->encp.vavon_eline,
				priv->io_base + _REG(ENCP_VIDEO_VAVON_ELINE));
		ग_लिखोl_relaxed(vmode->encp.hso_begin,
				priv->io_base + _REG(ENCP_VIDEO_HSO_BEGIN));
		ग_लिखोl_relaxed(vmode->encp.hso_end,
				priv->io_base + _REG(ENCP_VIDEO_HSO_END));
		ग_लिखोl_relaxed(vmode->encp.vso_begin,
				priv->io_base + _REG(ENCP_VIDEO_VSO_BEGIN));
		ग_लिखोl_relaxed(vmode->encp.vso_end,
				priv->io_base + _REG(ENCP_VIDEO_VSO_END));
		ग_लिखोl_relaxed(vmode->encp.vso_bline,
				priv->io_base + _REG(ENCP_VIDEO_VSO_BLINE));
		अगर (vmode->encp.vso_eline_present)
			ग_लिखोl_relaxed(vmode->encp.vso_eline,
				priv->io_base + _REG(ENCP_VIDEO_VSO_ELINE));
		अगर (vmode->encp.sy_val_present)
			ग_लिखोl_relaxed(vmode->encp.sy_val,
				priv->io_base + _REG(ENCP_VIDEO_SY_VAL));
		अगर (vmode->encp.sy2_val_present)
			ग_लिखोl_relaxed(vmode->encp.sy2_val,
				priv->io_base + _REG(ENCP_VIDEO_SY2_VAL));
		ग_लिखोl_relaxed(vmode->encp.max_lncnt,
				priv->io_base + _REG(ENCP_VIDEO_MAX_LNCNT));

		ग_लिखोl_relaxed(1, priv->io_base + _REG(ENCP_VIDEO_EN));

		/* Set DE संकेतै s polarity is active high */
		ग_लिखोl_bits_relaxed(ENCP_VIDEO_MODE_DE_V_HIGH,
				    ENCP_VIDEO_MODE_DE_V_HIGH,
				    priv->io_base + _REG(ENCP_VIDEO_MODE));

		/* Program DE timing */
		de_h_begin = modulo(पढ़ोl_relaxed(priv->io_base +
					_REG(ENCP_VIDEO_HAVON_BEGIN))
					+ venc_hdmi_latency,
				    total_pixels_venc);
		de_h_end = modulo(de_h_begin + active_pixels_venc,
				  total_pixels_venc);

		ग_लिखोl_relaxed(de_h_begin,
				priv->io_base + _REG(ENCP_DE_H_BEGIN));
		ग_लिखोl_relaxed(de_h_end,
				priv->io_base + _REG(ENCP_DE_H_END));

		/* Program DE timing क्रम even field */
		de_v_begin_even = पढ़ोl_relaxed(priv->io_base
						+ _REG(ENCP_VIDEO_VAVON_BLINE));
		अगर (mode->flags & DRM_MODE_FLAG_INTERLACE)
			de_v_end_even = de_v_begin_even +
					(mode->vdisplay / 2);
		अन्यथा
			de_v_end_even = de_v_begin_even + mode->vdisplay;

		ग_लिखोl_relaxed(de_v_begin_even,
				priv->io_base + _REG(ENCP_DE_V_BEGIN_EVEN));
		ग_लिखोl_relaxed(de_v_end_even,
				priv->io_base + _REG(ENCP_DE_V_END_EVEN));

		/* Program DE timing क्रम odd field अगर needed */
		अगर (mode->flags & DRM_MODE_FLAG_INTERLACE) अणु
			अचिन्हित पूर्णांक ofld_voav_ofst =
				पढ़ोl_relaxed(priv->io_base +
					_REG(ENCP_VIDEO_OFLD_VOAV_OFST));
			de_v_begin_odd = to_चिन्हित((ofld_voav_ofst & 0xf0) >> 4)
						+ de_v_begin_even
						+ ((mode->vtotal - 1) / 2);
			de_v_end_odd = de_v_begin_odd + (mode->vdisplay / 2);

			ग_लिखोl_relaxed(de_v_begin_odd,
				priv->io_base + _REG(ENCP_DE_V_BEGIN_ODD));
			ग_लिखोl_relaxed(de_v_end_odd,
				priv->io_base + _REG(ENCP_DE_V_END_ODD));
		पूर्ण

		/* Program Hsync timing */
		अगर ((de_h_end + front_porch_venc) >= total_pixels_venc) अणु
			hs_begin = de_h_end
				   + front_porch_venc
				   - total_pixels_venc;
			vs_adjust  = 1;
		पूर्ण अन्यथा अणु
			hs_begin = de_h_end
				   + front_porch_venc;
			vs_adjust  = 0;
		पूर्ण

		hs_end = modulo(hs_begin + hsync_pixels_venc,
				total_pixels_venc);

		ग_लिखोl_relaxed(hs_begin,
				priv->io_base + _REG(ENCP_DVI_HSO_BEGIN));
		ग_लिखोl_relaxed(hs_end,
				priv->io_base + _REG(ENCP_DVI_HSO_END));

		/* Program Vsync timing क्रम even field */
		अगर (de_v_begin_even >=
				(sof_lines + vsync_lines + (1 - vs_adjust)))
			vs_bline_evn = de_v_begin_even
					- sof_lines
					- vsync_lines
					- (1 - vs_adjust);
		अन्यथा
			vs_bline_evn = mode->vtotal
					+ de_v_begin_even
					- sof_lines
					- vsync_lines
					- (1 - vs_adjust);

		vs_eline_evn = modulo(vs_bline_evn + vsync_lines,
					mode->vtotal);

		ग_लिखोl_relaxed(vs_bline_evn,
				priv->io_base + _REG(ENCP_DVI_VSO_BLINE_EVN));
		ग_लिखोl_relaxed(vs_eline_evn,
				priv->io_base + _REG(ENCP_DVI_VSO_ELINE_EVN));

		vso_begin_evn = hs_begin;
		ग_लिखोl_relaxed(vso_begin_evn,
				priv->io_base + _REG(ENCP_DVI_VSO_BEGIN_EVN));
		ग_लिखोl_relaxed(vso_begin_evn,
				priv->io_base + _REG(ENCP_DVI_VSO_END_EVN));

		/* Program Vsync timing क्रम odd field अगर needed */
		अगर (mode->flags & DRM_MODE_FLAG_INTERLACE) अणु
			vs_bline_odd = (de_v_begin_odd - 1)
					- sof_lines
					- vsync_lines;
			vs_eline_odd = (de_v_begin_odd - 1)
					- vsync_lines;
			vso_begin_odd  = modulo(hs_begin
						+ (total_pixels_venc >> 1),
						total_pixels_venc);

			ग_लिखोl_relaxed(vs_bline_odd,
				priv->io_base + _REG(ENCP_DVI_VSO_BLINE_ODD));
			ग_लिखोl_relaxed(vs_eline_odd,
				priv->io_base + _REG(ENCP_DVI_VSO_ELINE_ODD));
			ग_लिखोl_relaxed(vso_begin_odd,
				priv->io_base + _REG(ENCP_DVI_VSO_BEGIN_ODD));
			ग_लिखोl_relaxed(vso_begin_odd,
				priv->io_base + _REG(ENCP_DVI_VSO_END_ODD));
		पूर्ण

		/* Select ENCP क्रम VIU */
		meson_vpp_setup_mux(priv, MESON_VIU_VPP_MUX_ENCP);
	पूर्ण

	/* Set VPU HDMI setting */
	/* Select ENCP or ENCI data to HDMI */
	अगर (use_enci)
		reg = VPU_HDMI_ENCI_DATA_TO_HDMI;
	अन्यथा
		reg = VPU_HDMI_ENCP_DATA_TO_HDMI;

	/* Invert polarity of HSYNC from VENC */
	अगर (mode->flags & DRM_MODE_FLAG_PHSYNC)
		reg |= VPU_HDMI_INV_HSYNC;

	/* Invert polarity of VSYNC from VENC */
	अगर (mode->flags & DRM_MODE_FLAG_PVSYNC)
		reg |= VPU_HDMI_INV_VSYNC;

	/* Output data क्रमmat */
	reg |= ycrcb_map;

	/*
	 * Write rate to the async FIFO between VENC and HDMI.
	 * One ग_लिखो every 2 wr_clk.
	 */
	अगर (venc_repeat || yuv420_mode)
		reg |= VPU_HDMI_WR_RATE(2);

	/*
	 * Read rate to the async FIFO between VENC and HDMI.
	 * One पढ़ो every 2 wr_clk.
	 */
	अगर (hdmi_repeat)
		reg |= VPU_HDMI_RD_RATE(2);

	ग_लिखोl_relaxed(reg, priv->io_base + _REG(VPU_HDMI_SETTING));

	priv->venc.hdmi_repeat = hdmi_repeat;
	priv->venc.venc_repeat = venc_repeat;
	priv->venc.hdmi_use_enci = use_enci;

	priv->venc.current_mode = MESON_VENC_MODE_HDMI;
पूर्ण
EXPORT_SYMBOL_GPL(meson_venc_hdmi_mode_set);

व्योम meson_venci_cvbs_mode_set(काष्ठा meson_drm *priv,
			       काष्ठा meson_cvbs_enci_mode *mode)
अणु
	u32 reg;

	अगर (mode->mode_tag == priv->venc.current_mode)
		वापस;

	/* CVBS Filter settings */
	ग_लिखोl_relaxed(ENCI_CFILT_CMPT_SEL_HIGH | 0x10,
		       priv->io_base + _REG(ENCI_CFILT_CTRL));
	ग_लिखोl_relaxed(ENCI_CFILT_CMPT_CR_DLY(2) |
		       ENCI_CFILT_CMPT_CB_DLY(1),
		       priv->io_base + _REG(ENCI_CFILT_CTRL2));

	/* Digital Video Select : Interlace, clk27 clk, बाह्यal */
	ग_लिखोl_relaxed(0, priv->io_base + _REG(VENC_DVI_SETTING));

	/* Reset Video Mode */
	ग_लिखोl_relaxed(0, priv->io_base + _REG(ENCI_VIDEO_MODE));
	ग_लिखोl_relaxed(0, priv->io_base + _REG(ENCI_VIDEO_MODE_ADV));

	/* Horizontal sync संकेत output */
	ग_लिखोl_relaxed(mode->hso_begin,
			priv->io_base + _REG(ENCI_SYNC_HSO_BEGIN));
	ग_लिखोl_relaxed(mode->hso_end,
			priv->io_base + _REG(ENCI_SYNC_HSO_END));

	/* Vertical Sync lines */
	ग_लिखोl_relaxed(mode->vso_even,
			priv->io_base + _REG(ENCI_SYNC_VSO_EVNLN));
	ग_लिखोl_relaxed(mode->vso_odd,
			priv->io_base + _REG(ENCI_SYNC_VSO_ODDLN));

	/* Macrovision max amplitude change */
	ग_लिखोl_relaxed(ENCI_MACV_MAX_AMP_ENABLE_CHANGE |
		       ENCI_MACV_MAX_AMP_VAL(mode->macv_max_amp),
		       priv->io_base + _REG(ENCI_MACV_MAX_AMP));

	/* Video mode */
	ग_लिखोl_relaxed(mode->video_prog_mode,
			priv->io_base + _REG(VENC_VIDEO_PROG_MODE));
	ग_लिखोl_relaxed(mode->video_mode,
			priv->io_base + _REG(ENCI_VIDEO_MODE));

	/*
	 * Advanced Video Mode :
	 * Demux shअगरting 0x2
	 * Blank line end at line17/22
	 * High bandwidth Luma Filter
	 * Low bandwidth Chroma Filter
	 * Bypass luma low pass filter
	 * No macrovision on CSYNC
	 */
	ग_लिखोl_relaxed(ENCI_VIDEO_MODE_ADV_DMXMD(2) |
		       ENCI_VIDEO_MODE_ADV_VBICTL_LINE_17_22 |
		       ENCI_VIDEO_MODE_ADV_YBW_HIGH,
		       priv->io_base + _REG(ENCI_VIDEO_MODE_ADV));

	ग_लिखोl(mode->sch_adjust, priv->io_base + _REG(ENCI_VIDEO_SCH));

	/* Sync mode : MASTER Master mode, मुक्त run, send HSO/VSO out */
	ग_लिखोl_relaxed(0x07, priv->io_base + _REG(ENCI_SYNC_MODE));

	/* 0x3 Y, C, and Component Y delay */
	ग_लिखोl_relaxed(mode->yc_delay, priv->io_base + _REG(ENCI_YC_DELAY));

	/* Timings */
	ग_लिखोl_relaxed(mode->pixel_start,
			priv->io_base + _REG(ENCI_VFIFO2VD_PIXEL_START));
	ग_लिखोl_relaxed(mode->pixel_end,
			priv->io_base + _REG(ENCI_VFIFO2VD_PIXEL_END));

	ग_लिखोl_relaxed(mode->top_field_line_start,
			priv->io_base + _REG(ENCI_VFIFO2VD_LINE_TOP_START));
	ग_लिखोl_relaxed(mode->top_field_line_end,
			priv->io_base + _REG(ENCI_VFIFO2VD_LINE_TOP_END));

	ग_लिखोl_relaxed(mode->bottom_field_line_start,
			priv->io_base + _REG(ENCI_VFIFO2VD_LINE_BOT_START));
	ग_लिखोl_relaxed(mode->bottom_field_line_end,
			priv->io_base + _REG(ENCI_VFIFO2VD_LINE_BOT_END));

	/* Internal Venc, Internal VIU Sync, Internal Vencoder */
	ग_लिखोl_relaxed(0, priv->io_base + _REG(VENC_SYNC_ROUTE));

	/* UNreset Interlaced TV Encoder */
	ग_लिखोl_relaxed(0, priv->io_base + _REG(ENCI_DBG_PX_RST));

	/*
	 * Enable Vfअगरo2vd and set Y_Cb_Y_Cr:
	 * Corresponding value:
	 * Y  => 00 or 10
	 * Cb => 01
	 * Cr => 11
	 * Ex: 0x4e => 01001110 would mean Cb/Y/Cr/Y
	 */
	ग_लिखोl_relaxed(ENCI_VFIFO2VD_CTL_ENABLE |
		       ENCI_VFIFO2VD_CTL_VD_SEL(0x4e),
		       priv->io_base + _REG(ENCI_VFIFO2VD_CTL));

	/* Power UP Dacs */
	ग_लिखोl_relaxed(0, priv->io_base + _REG(VENC_VDAC_SETTING));

	/* Video Upsampling */
	/*
	 * CTRL0, CTRL1 and CTRL2:
	 * Filter0: input data sample every 2 cloks
	 * Filter1: filtering and upsample enable
	 */
	reg = VENC_UPSAMPLE_CTRL_F0_2_CLK_RATIO | VENC_UPSAMPLE_CTRL_F1_EN |
		VENC_UPSAMPLE_CTRL_F1_UPSAMPLE_EN;

	/*
	 * Upsample CTRL0:
	 * Interlace High Bandwidth Luma
	 */
	ग_लिखोl_relaxed(VENC_UPSAMPLE_CTRL_INTERLACE_HIGH_LUMA | reg,
		       priv->io_base + _REG(VENC_UPSAMPLE_CTRL0));

	/*
	 * Upsample CTRL1:
	 * Interlace Pb
	 */
	ग_लिखोl_relaxed(VENC_UPSAMPLE_CTRL_INTERLACE_PB | reg,
		       priv->io_base + _REG(VENC_UPSAMPLE_CTRL1));

	/*
	 * Upsample CTRL2:
	 * Interlace R
	 */
	ग_लिखोl_relaxed(VENC_UPSAMPLE_CTRL_INTERLACE_PR | reg,
		       priv->io_base + _REG(VENC_UPSAMPLE_CTRL2));

	/* Select Interlace Y DACs */
	ग_लिखोl_relaxed(0, priv->io_base + _REG(VENC_VDAC_DACSEL0));
	ग_लिखोl_relaxed(0, priv->io_base + _REG(VENC_VDAC_DACSEL1));
	ग_लिखोl_relaxed(0, priv->io_base + _REG(VENC_VDAC_DACSEL2));
	ग_लिखोl_relaxed(0, priv->io_base + _REG(VENC_VDAC_DACSEL3));
	ग_लिखोl_relaxed(0, priv->io_base + _REG(VENC_VDAC_DACSEL4));
	ग_लिखोl_relaxed(0, priv->io_base + _REG(VENC_VDAC_DACSEL5));

	/* Select ENCI क्रम VIU */
	meson_vpp_setup_mux(priv, MESON_VIU_VPP_MUX_ENCI);

	/* Enable ENCI FIFO */
	ग_लिखोl_relaxed(VENC_VDAC_FIFO_EN_ENCI_ENABLE,
		       priv->io_base + _REG(VENC_VDAC_FIFO_CTRL));

	/* Select ENCI DACs 0, 1, 4, and 5 */
	ग_लिखोl_relaxed(0x11, priv->io_base + _REG(ENCI_DACSEL_0));
	ग_लिखोl_relaxed(0x11, priv->io_base + _REG(ENCI_DACSEL_1));

	/* Interlace video enable */
	ग_लिखोl_relaxed(ENCI_VIDEO_EN_ENABLE,
		       priv->io_base + _REG(ENCI_VIDEO_EN));

	/* Configure Video Saturation / Contrast / Brightness / Hue */
	ग_लिखोl_relaxed(mode->video_saturation,
			priv->io_base + _REG(ENCI_VIDEO_SAT));
	ग_लिखोl_relaxed(mode->video_contrast,
			priv->io_base + _REG(ENCI_VIDEO_CONT));
	ग_लिखोl_relaxed(mode->video_brightness,
			priv->io_base + _REG(ENCI_VIDEO_BRIGHT));
	ग_लिखोl_relaxed(mode->video_hue,
			priv->io_base + _REG(ENCI_VIDEO_HUE));

	/* Enable DAC0 Filter */
	ग_लिखोl_relaxed(VENC_VDAC_DAC0_FILT_CTRL0_EN,
		       priv->io_base + _REG(VENC_VDAC_DAC0_FILT_CTRL0));
	ग_लिखोl_relaxed(0xfc48, priv->io_base + _REG(VENC_VDAC_DAC0_FILT_CTRL1));

	/* 0 in Macrovision रेजिस्टर 0 */
	ग_लिखोl_relaxed(0, priv->io_base + _REG(ENCI_MACV_N0));

	/* Analog Synchronization and color burst value adjust */
	ग_लिखोl_relaxed(mode->analog_sync_adj,
			priv->io_base + _REG(ENCI_SYNC_ADJ));

	priv->venc.current_mode = mode->mode_tag;
पूर्ण

/* Returns the current ENCI field polarity */
अचिन्हित पूर्णांक meson_venci_get_field(काष्ठा meson_drm *priv)
अणु
	वापस पढ़ोl_relaxed(priv->io_base + _REG(ENCI_INFO_READ)) & BIT(29);
पूर्ण

व्योम meson_venc_enable_vsync(काष्ठा meson_drm *priv)
अणु
	ग_लिखोl_relaxed(VENC_INTCTRL_ENCI_LNRST_INT_EN,
		       priv->io_base + _REG(VENC_INTCTRL));
	regmap_update_bits(priv->hhi, HHI_GCLK_MPEG2, BIT(25), BIT(25));
पूर्ण

व्योम meson_venc_disable_vsync(काष्ठा meson_drm *priv)
अणु
	regmap_update_bits(priv->hhi, HHI_GCLK_MPEG2, BIT(25), 0);
	ग_लिखोl_relaxed(0, priv->io_base + _REG(VENC_INTCTRL));
पूर्ण

व्योम meson_venc_init(काष्ठा meson_drm *priv)
अणु
	/* Disable CVBS VDAC */
	अगर (meson_vpu_is_compatible(priv, VPU_COMPATIBLE_G12A)) अणु
		regmap_ग_लिखो(priv->hhi, HHI_VDAC_CNTL0_G12A, 0);
		regmap_ग_लिखो(priv->hhi, HHI_VDAC_CNTL1_G12A, 8);
	पूर्ण अन्यथा अणु
		regmap_ग_लिखो(priv->hhi, HHI_VDAC_CNTL0, 0);
		regmap_ग_लिखो(priv->hhi, HHI_VDAC_CNTL1, 8);
	पूर्ण

	/* Power Down Dacs */
	ग_लिखोl_relaxed(0xff, priv->io_base + _REG(VENC_VDAC_SETTING));

	/* Disable HDMI PHY */
	regmap_ग_लिखो(priv->hhi, HHI_HDMI_PHY_CNTL0, 0);

	/* Disable HDMI */
	ग_लिखोl_bits_relaxed(VPU_HDMI_ENCI_DATA_TO_HDMI |
			    VPU_HDMI_ENCP_DATA_TO_HDMI, 0,
			    priv->io_base + _REG(VPU_HDMI_SETTING));

	/* Disable all encoders */
	ग_लिखोl_relaxed(0, priv->io_base + _REG(ENCI_VIDEO_EN));
	ग_लिखोl_relaxed(0, priv->io_base + _REG(ENCP_VIDEO_EN));
	ग_लिखोl_relaxed(0, priv->io_base + _REG(ENCL_VIDEO_EN));

	/* Disable VSync IRQ */
	meson_venc_disable_vsync(priv);

	priv->venc.current_mode = MESON_VENC_MODE_NONE;
पूर्ण
