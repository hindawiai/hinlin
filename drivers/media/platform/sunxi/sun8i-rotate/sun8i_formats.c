<शैली गुरु>
// SPDX-License-Identअगरier: GPL-2.0
/* Copyright (C) 2020 Jernej Skrabec <jernej.skrabec@siol.net> */

#समावेश "sun8i-formats.h"
#समावेश "sun8i-rotate.h"

/*
 * Formats not included in array:
 * ROTATE_FORMAT_BGR565
 * ROTATE_FORMAT_VYUV
 */

अटल स्थिर काष्ठा rotate_क्रमmat rotate_क्रमmats[] = अणु
	अणु
		.fourcc = V4L2_PIX_FMT_ARGB32,
		.hw_क्रमmat = ROTATE_FORMAT_ARGB32,
		.planes = 1,
		.bpp = अणु 4, 0, 0 पूर्ण,
		.hsub = 1,
		.vsub = 1,
		.flags = ROTATE_FLAG_OUTPUT
	पूर्ण, अणु
		.fourcc = V4L2_PIX_FMT_ABGR32,
		.hw_क्रमmat = ROTATE_FORMAT_ABGR32,
		.planes = 1,
		.bpp = अणु 4, 0, 0 पूर्ण,
		.hsub = 1,
		.vsub = 1,
		.flags = ROTATE_FLAG_OUTPUT
	पूर्ण, अणु
		.fourcc = V4L2_PIX_FMT_RGBA32,
		.hw_क्रमmat = ROTATE_FORMAT_RGBA32,
		.planes = 1,
		.bpp = अणु 4, 0, 0 पूर्ण,
		.hsub = 1,
		.vsub = 1,
		.flags = ROTATE_FLAG_OUTPUT
	पूर्ण, अणु
		.fourcc = V4L2_PIX_FMT_BGRA32,
		.hw_क्रमmat = ROTATE_FORMAT_BGRA32,
		.planes = 1,
		.bpp = अणु 4, 0, 0 पूर्ण,
		.hsub = 1,
		.vsub = 1,
		.flags = ROTATE_FLAG_OUTPUT
	पूर्ण, अणु
		.fourcc = V4L2_PIX_FMT_XRGB32,
		.hw_क्रमmat = ROTATE_FORMAT_XRGB32,
		.planes = 1,
		.bpp = अणु 4, 0, 0 पूर्ण,
		.hsub = 1,
		.vsub = 1,
		.flags = ROTATE_FLAG_OUTPUT
	पूर्ण, अणु
		.fourcc = V4L2_PIX_FMT_XBGR32,
		.hw_क्रमmat = ROTATE_FORMAT_XBGR32,
		.planes = 1,
		.bpp = अणु 4, 0, 0 पूर्ण,
		.hsub = 1,
		.vsub = 1,
		.flags = ROTATE_FLAG_OUTPUT
	पूर्ण, अणु
		.fourcc = V4L2_PIX_FMT_RGB32,
		.hw_क्रमmat = ROTATE_FORMAT_RGBX32,
		.planes = 1,
		.bpp = अणु 4, 0, 0 पूर्ण,
		.hsub = 1,
		.vsub = 1,
		.flags = ROTATE_FLAG_OUTPUT
	पूर्ण, अणु
		.fourcc = V4L2_PIX_FMT_BGR32,
		.hw_क्रमmat = ROTATE_FORMAT_BGRX32,
		.planes = 1,
		.bpp = अणु 4, 0, 0 पूर्ण,
		.hsub = 1,
		.vsub = 1,
		.flags = ROTATE_FLAG_OUTPUT
	पूर्ण, अणु
		.fourcc = V4L2_PIX_FMT_RGB24,
		.hw_क्रमmat = ROTATE_FORMAT_RGB24,
		.planes = 1,
		.bpp = अणु 3, 0, 0 पूर्ण,
		.hsub = 1,
		.vsub = 1,
		.flags = ROTATE_FLAG_OUTPUT
	पूर्ण, अणु
		.fourcc = V4L2_PIX_FMT_BGR24,
		.hw_क्रमmat = ROTATE_FORMAT_BGR24,
		.planes = 1,
		.bpp = अणु 3, 0, 0 पूर्ण,
		.hsub = 1,
		.vsub = 1,
		.flags = ROTATE_FLAG_OUTPUT
	पूर्ण, अणु
		.fourcc = V4L2_PIX_FMT_RGB565,
		.hw_क्रमmat = ROTATE_FORMAT_RGB565,
		.planes = 1,
		.bpp = अणु 2, 0, 0 पूर्ण,
		.hsub = 1,
		.vsub = 1,
		.flags = ROTATE_FLAG_OUTPUT
	पूर्ण, अणु
		.fourcc = V4L2_PIX_FMT_ARGB444,
		.hw_क्रमmat = ROTATE_FORMAT_ARGB4444,
		.planes = 1,
		.bpp = अणु 2, 0, 0 पूर्ण,
		.hsub = 1,
		.vsub = 1,
		.flags = ROTATE_FLAG_OUTPUT
	पूर्ण, अणु
		.fourcc = V4L2_PIX_FMT_ABGR444,
		.hw_क्रमmat = ROTATE_FORMAT_ABGR4444,
		.planes = 1,
		.bpp = अणु 2, 0, 0 पूर्ण,
		.hsub = 1,
		.vsub = 1,
		.flags = ROTATE_FLAG_OUTPUT
	पूर्ण, अणु
		.fourcc = V4L2_PIX_FMT_RGBA444,
		.hw_क्रमmat = ROTATE_FORMAT_RGBA4444,
		.planes = 1,
		.bpp = अणु 2, 0, 0 पूर्ण,
		.hsub = 1,
		.vsub = 1,
		.flags = ROTATE_FLAG_OUTPUT
	पूर्ण, अणु
		.fourcc = V4L2_PIX_FMT_BGRA444,
		.hw_क्रमmat = ROTATE_FORMAT_BGRA4444,
		.planes = 1,
		.bpp = अणु 2, 0, 0 पूर्ण,
		.hsub = 1,
		.vsub = 1,
		.flags = ROTATE_FLAG_OUTPUT
	पूर्ण, अणु
		.fourcc = V4L2_PIX_FMT_ARGB555,
		.hw_क्रमmat = ROTATE_FORMAT_ARGB1555,
		.planes = 1,
		.bpp = अणु 2, 0, 0 पूर्ण,
		.hsub = 1,
		.vsub = 1,
		.flags = ROTATE_FLAG_OUTPUT
	पूर्ण, अणु
		.fourcc = V4L2_PIX_FMT_ABGR555,
		.hw_क्रमmat = ROTATE_FORMAT_ABGR1555,
		.planes = 1,
		.bpp = अणु 2, 0, 0 पूर्ण,
		.hsub = 1,
		.vsub = 1,
		.flags = ROTATE_FLAG_OUTPUT
	पूर्ण, अणु
		.fourcc = V4L2_PIX_FMT_RGBA555,
		.hw_क्रमmat = ROTATE_FORMAT_RGBA5551,
		.planes = 1,
		.bpp = अणु 2, 0, 0 पूर्ण,
		.hsub = 1,
		.vsub = 1,
		.flags = ROTATE_FLAG_OUTPUT
	पूर्ण, अणु
		.fourcc = V4L2_PIX_FMT_BGRA555,
		.hw_क्रमmat = ROTATE_FORMAT_BGRA5551,
		.planes = 1,
		.bpp = अणु 2, 0, 0 पूर्ण,
		.hsub = 1,
		.vsub = 1,
		.flags = ROTATE_FLAG_OUTPUT
	पूर्ण, अणु
		.fourcc = V4L2_PIX_FMT_YVYU,
		.hw_क्रमmat = ROTATE_FORMAT_YVYU,
		.planes = 1,
		.bpp = अणु 2, 0, 0 पूर्ण,
		.hsub = 2,
		.vsub = 1,
		.flags = ROTATE_FLAG_YUV
	पूर्ण, अणु
		.fourcc = V4L2_PIX_FMT_UYVY,
		.hw_क्रमmat = ROTATE_FORMAT_UYVY,
		.planes = 1,
		.bpp = अणु 2, 0, 0 पूर्ण,
		.hsub = 2,
		.vsub = 1,
		.flags = ROTATE_FLAG_YUV
	पूर्ण, अणु
		.fourcc = V4L2_PIX_FMT_YUYV,
		.hw_क्रमmat = ROTATE_FORMAT_YUYV,
		.planes = 1,
		.bpp = अणु 2, 0, 0 पूर्ण,
		.hsub = 2,
		.vsub = 1,
		.flags = ROTATE_FLAG_YUV
	पूर्ण, अणु
		.fourcc = V4L2_PIX_FMT_NV61,
		.hw_क्रमmat = ROTATE_FORMAT_NV61,
		.planes = 2,
		.bpp = अणु 1, 2, 0 पूर्ण,
		.hsub = 2,
		.vsub = 1,
		.flags = ROTATE_FLAG_YUV
	पूर्ण, अणु
		.fourcc = V4L2_PIX_FMT_NV16,
		.hw_क्रमmat = ROTATE_FORMAT_NV16,
		.planes = 2,
		.bpp = अणु 1, 2, 0 पूर्ण,
		.hsub = 2,
		.vsub = 1,
		.flags = ROTATE_FLAG_YUV
	पूर्ण, अणु
		.fourcc = V4L2_PIX_FMT_YUV422P,
		.hw_क्रमmat = ROTATE_FORMAT_YUV422P,
		.planes = 3,
		.bpp = अणु 1, 1, 1 पूर्ण,
		.hsub = 2,
		.vsub = 1,
		.flags = ROTATE_FLAG_YUV
	पूर्ण, अणु
		.fourcc = V4L2_PIX_FMT_NV21,
		.hw_क्रमmat = ROTATE_FORMAT_NV21,
		.planes = 2,
		.bpp = अणु 1, 2, 0 पूर्ण,
		.hsub = 2,
		.vsub = 2,
		.flags = ROTATE_FLAG_YUV
	पूर्ण, अणु
		.fourcc = V4L2_PIX_FMT_NV12,
		.hw_क्रमmat = ROTATE_FORMAT_NV12,
		.planes = 2,
		.bpp = अणु 1, 2, 0 पूर्ण,
		.hsub = 2,
		.vsub = 2,
		.flags = ROTATE_FLAG_YUV
	पूर्ण, अणु
		.fourcc = V4L2_PIX_FMT_YUV420,
		.hw_क्रमmat = ROTATE_FORMAT_YUV420P,
		.planes = 3,
		.bpp = अणु 1, 1, 1 पूर्ण,
		.hsub = 2,
		.vsub = 2,
		.flags = ROTATE_FLAG_YUV | ROTATE_FLAG_OUTPUT
	पूर्ण,
पूर्ण;

स्थिर काष्ठा rotate_क्रमmat *rotate_find_क्रमmat(u32 pixelक्रमmat)
अणु
	अचिन्हित पूर्णांक i;

	क्रम (i = 0; i < ARRAY_SIZE(rotate_क्रमmats); i++)
		अगर (rotate_क्रमmats[i].fourcc == pixelक्रमmat)
			वापस &rotate_क्रमmats[i];

	वापस शून्य;
पूर्ण

पूर्णांक rotate_क्रमागत_fmt(काष्ठा v4l2_fmtdesc *f, bool dst)
अणु
	पूर्णांक i, index;

	index = 0;

	क्रम (i = 0; i < ARRAY_SIZE(rotate_क्रमmats); i++) अणु
		/* not all क्रमmats can be used क्रम capture buffers */
		अगर (dst && !(rotate_क्रमmats[i].flags & ROTATE_FLAG_OUTPUT))
			जारी;

		अगर (index == f->index) अणु
			f->pixelक्रमmat = rotate_क्रमmats[i].fourcc;

			वापस 0;
		पूर्ण

		index++;
	पूर्ण

	वापस -EINVAL;
पूर्ण
