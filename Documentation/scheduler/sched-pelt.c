<शैली गुरु>
/*
 * The following program is used to generate the स्थिरants क्रम
 * computing sched averages.
 *
 * ==============================================================
 *		C program (compile with -lm)
 * ==============================================================
 */

#समावेश <गणित.स>
#समावेश <मानकपन.स>

#घोषणा HALFLIFE 32
#घोषणा SHIFT 32

द्विगुन y;

व्योम calc_runnable_avg_yN_inv(व्योम)
अणु
	पूर्णांक i;
	अचिन्हित पूर्णांक x;

	/* To silence -Wunused-but-set-variable warnings. */
	म_लिखो("static const u32 runnable_avg_yN_inv[] __maybe_unused = {");
	क्रम (i = 0; i < HALFLIFE; i++) अणु
		x = ((1UL<<32)-1)*घात(y, i);

		अगर (i % 6 == 0) म_लिखो("\n\t");
		म_लिखो("0x%8x, ", x);
	पूर्ण
	म_लिखो("\n};\n\n");
पूर्ण

पूर्णांक sum = 1024;

व्योम calc_runnable_avg_yN_sum(व्योम)
अणु
	पूर्णांक i;

	म_लिखो("static const u32 runnable_avg_yN_sum[] = {\n\t    0,");
	क्रम (i = 1; i <= HALFLIFE; i++) अणु
		अगर (i == 1)
			sum *= y;
		अन्यथा
			sum = sum*y + 1024*y;

		अगर (i % 11 == 0)
			म_लिखो("\n\t");

		म_लिखो("%5d,", sum);
	पूर्ण
	म_लिखो("\n};\n\n");
पूर्ण

पूर्णांक n = -1;
/* first period */
दीर्घ max = 1024;

व्योम calc_converged_max(व्योम)
अणु
	दीर्घ last = 0, y_inv = ((1UL<<32)-1)*y;

	क्रम (; ; n++) अणु
		अगर (n > -1)
			max = ((max*y_inv)>>SHIFT) + 1024;
			/*
			 * This is the same as:
			 * max = max*y + 1024;
			 */

		अगर (last == max)
			अवरोध;

		last = max;
	पूर्ण
	n--;
	म_लिखो("#define LOAD_AVG_PERIOD %d\n", HALFLIFE);
	म_लिखो("#define LOAD_AVG_MAX %ld\n", max);
//	म_लिखो("#define LOAD_AVG_MAX_N %d\n\n", n);
पूर्ण

व्योम calc_accumulated_sum_32(व्योम)
अणु
	पूर्णांक i, x = sum;

	म_लिखो("static const u32 __accumulated_sum_N32[] = {\n\t     0,");
	क्रम (i = 1; i <= n/HALFLIFE+1; i++) अणु
		अगर (i > 1)
			x = x/2 + sum;

		अगर (i % 6 == 0)
			म_लिखो("\n\t");

		म_लिखो("%6d,", x);
	पूर्ण
	म_लिखो("\n};\n\n");
पूर्ण

व्योम मुख्य(व्योम)
अणु
	म_लिखो("/* Generated by Documentation/scheduler/sched-pelt; do not modify. */\n\n");

	y = घात(0.5, 1/(द्विगुन)HALFLIFE);

	calc_runnable_avg_yN_inv();
//	calc_runnable_avg_yN_sum();
	calc_converged_max();
//	calc_accumulated_sum_32();
पूर्ण
